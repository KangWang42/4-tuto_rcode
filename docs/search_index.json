[["index.html", "科研学帮帮 简介", " 科研学帮帮 wang 2024.10.19 简介 欢迎参观博客：https://wk8686.top/ 我的主页：https://intro.wk8686.top/ Hello there! I’m Wang. ⭐️ From KangWang42 欢迎参观我的blog 扫码关注我的公众号 "],["r语言学习路径和资料.html", "1 R语言学习路径和资料 1.1 声明 1.2 阶段1：下载好r并使用 1.3 阶段2：学习baseR 1.4 阶段3：开始学习tidyverse 1.5 阶段4：学习可视化 1.6 阶段5 统计分析 1.7 阶段5 机器学习等 1.8 阶段6 其他", " 1 R语言学习路径和资料 1.1 声明 内容仅为个人学习的经验，并且并不详细。只为方向性引导，大家学习的时候要多在网络上查找资料 1.2 阶段1：下载好r并使用 先安装最新的R 再安装IDE 最常用的IDE就是Rstudio 我目前用的是positron会出一期专门介绍，但是因为还没正式版，有需要的同学可以去看看更新进展 了解软件的基本窗口和操作 1.3 阶段2：学习baseR 1.3.1 推荐资料 链接：公认R语言学习最好的书，学习起来清晰通俗，学习路线极其明确 1.3.2 学习路线 基础语法：懂得基础的语法知识，安装包，导入包，设定工作路径，使用函数，数据导出 数据结构：画重点，各个数据结构务必要务必了解。向量还是数据框还是列表，都了解后才能get到后续的列表嵌套数据框和数据框嵌套列表 数据处理：主要处理的对象是数据框，操作包括但不限于变量recode，变量筛选，数据框长宽转换，新建变量，重复值处理 数据可视化：可放单独一块学习，前期不用学习 统计分析：可做什么去学什么，前期不用学 机器学习（深度学习）：同上 1.4 阶段3：开始学习tidyverse 1.4.1 推荐资料 R语言编程:最好的tidyverse入门书，确实讲的通俗易懂，作者在知乎上有账号，关注不亏 R数据科学：Hadley Wickham（tidyverse的作者）写的书，讲的很详细，建议细细细细过一遍，获益匪浅 1.4.2 学习路径 直接参考加载包的时候的导入函数，一个个学 library(tidyverse) ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ── ## ✔ dplyr 1.1.4 ✔ readr 2.1.5 ## ✔ forcats 1.0.0 ✔ stringr 1.5.1 ## ✔ ggplot2 3.5.1 ✔ tibble 3.2.1 ## ✔ lubridate 1.9.3 ✔ tidyr 1.3.1 ## ✔ purrr 1.0.2 ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ── ## ✖ dplyr::filter() masks stats::filter() ## ✖ dplyr::lag() masks stats::lag() ## ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors 学习数据导入(readr) 学习新的数据结构（tibble：datafram优化版） 学习数据处理，变量筛选等(dplyr) 学习字符变量的处理(stringr) 学习因子变量的处理(forcats) 学习数据可视化(ggplot2) 学习函数式循环（purrr）务必要学 1.5 阶段4：学习可视化 1.5.1 学习资料 R数据可视化手册 第2版：系统的看一遍 各大知乎csdn微信公众号关键词搜索：都是宝藏呀 或者来我的云盘看一看 1.6 阶段5 统计分析 推荐一个公众号：R语言实战 平时什么统计分析不会全是知乎教我 1.7 阶段5 机器学习等 mlr3verse包，张敬信大佬可能这两年就会出书介绍 1.8 阶段6 其他 rweekly论坛 tidyverse博客 "],["rmarkdown教程-初学r语言推荐.html", "2 rmarkdown教程-初学r语言推荐 2.1 rmarkdown介绍 2.2 rmarkdown使用 2.3 rmarkdown界面 2.4 rticles包-rmarkdown模板 2.5 rmarkdown编译 2.6 rmarkdown的块设置 2.7 更多教程", " 2 rmarkdown教程-初学r语言推荐 2.1 rmarkdown介绍 rmarkdown是一种将r语言代码和markdown语法整合在一起的工具，它可以将r语言代码的执行结果和文字、图片、表格等内容整合在一起，形成一个完整的文档。rmarkdown的文档可以导出为html、pdf、word等格式的文档。rmarkdown的文档可以在github上免费发布，也可以在rstudio上免费发布。rmarkdown的文档可以在 rmarkdown主要用于逐段运行代码并展示结果，生成演示文档，生成html用于其它平台发布，搭配bookdown搭建网页教程 刚学习r语言的同学可以使用rmarkdown来学习r语言，不仅可以在段落中间穿插个人说明，同时用markdown的大纲符号“#”可以让代码结构清晰 2.2 rmarkdown使用 在工具栏新建rmarkdown文档，会生成模板文件，在模板文件的基础上增删修改 2.3 rmarkdown界面 先把yaml里的文档原属性进行修改，作者标题修改一下，后期如果要发布展示会显示在页面最上方 用markdown语法新建大纲标题，用“#”符号，“#”符号越多，标题字号越小 用快捷键“ctrl+alt+i”可以在当前位置插入代码块，用“ctrl+alt+o”可以在当前位置插入输出块 尝试运行自己的代码吧 2.4 rticles包-rmarkdown模板 安装rticles包之后，在新建rmd文件处就能看到不同的模板，选择一个模板，就可以生成一个模板文件，模板文件的内容和模板的内容是一样的，但是模板文件的内容更加完善，模板文件的内容可以直接运行，模板文件的内容可以导出为html、pdf、word等格式的文档，模板文件的内容可以在github上免费发布，也可以在rstudio上免费发布 安装prettydoc包也是一样的效果 2.5 rmarkdown编译 代码完成后即可点击rstudio的“knit”按钮，即可编译，编译后会生成一个html文件，在html文件中可以看到代码的运行结果，同时也可以导出为pdf、word等格式的文档，导出的文档可以在github上免费发布，也可以在rstudio上免费发布 2.6 rmarkdown的块设置 rmarkdown主要是用于代码导出结果展示的包，同时在导出时我们会有侧重的设置某些代码块的运行。例如：设置一些块不运行，一些块运行但是不显示信息，一些块运行但是不报错，一些块运行但是不显示结果。 rmd的块设置共有7种，Code evaluation、Results、Code Decoration、Chunks、Cache、Animation、Plots。看起来复杂，其实实际使用到的也就几个，大家先过一遍，以后慢慢熟悉。 2.6.1 如何添加块设置 在块头处和r用空格隔开，不同设置间用“,”隔开 2.6.2 Code evaluation-设置块是否运行 2.6.2.1 eval参数 示例：“eval=F” 可设置不运行代码,注意这里不运行代码 print(&#39;这是运行结果&#39;) 2.6.2.2 include参数 示例：“include=F” 这里其实是有代码的，但是带着输出被一起隐藏了（占位符） 2.6.2.3 Results参数,设置结果输出 print(&quot;这是设置 result = &#39;hide&#39;的运行结果,虽然运行了，但是不显示&quot;) 2.6.2.4 collapse参数 ,为T表示代码和结果一起输出 下方设置为F效果 print(&#39;这是运行结果&#39;) ## [1] &quot;这是运行结果&quot; 2.6.3 echo参数，输出文档是否显示代码 设置为F之后，运行代码，但是只显示结果不显示代码 ## [1] &quot;这是运行结果&quot; 2.6.4 error、warning、message为同一类参数，当代码中有警告或者错误信息时是否展示，如果为F时即不展示。 print(&#39;这是运行结果&#39;) ## [1] &quot;这是运行结果&quot; 2.7 更多教程 中间介绍了几个我常用的，更多的rmd教程可直接阅读官方的使用手册 "],["brucer-r包里的瑞士军刀.html", "3 bruceR-r包里的瑞士军刀 3.1 r包介绍 3.2 r包安装 3.3 基础使用 3.4 其它函数", " 3 bruceR-r包里的瑞士军刀 3.1 r包介绍 使用教程 作者在日常工作中集各常用包于大成，凝结出了bruceR，很多内容都是专门为科研而生，减少了很多工作 可以实现以下功能！星标一看！安装即用 设置路径 数据打印和三线表制作 数据编码 数据框的横向计算 一致性检验 探索性因子分析 验证性因子分析 描述统计 统计结果summary 结构方程模型 等等等 3.2 r包安装 CRAN直接安装 或者 github库安装 install.packages(&quot;devtools&quot;) devtools::install_github(&quot;psychbruce/bruceR&quot;, dep=TRUE, force=TRUE) 3.3 基础使用 #install.packages(&quot;bruceR&quot;) library(&quot;bruceR&quot;) 3.3.1 set_wd:设置工作路径 快速将当前r文档路径设为工作路径 set_wd() 3.3.2 import:一个函数导入或导出各种数据 import函数支持但不限于几乎常用数据库的导入 - 文本格式 txt, .csv, .csv2, .tsv, .psv - Excel (.xls, .xlsx) - SPSS (.sav) - Stata (.dta) - R objects (.rda, .rdata, .RData) - R serialized objects (.rds) - Clipboard（on Windows and Mac OS） 3.3.3 print_table：快速生成三线表 print_table(npk) ## ────────────────────── ## block N P K yield ## ────────────────────── ## 1 1 0 1 1 49.500 ## 2 1 1 1 0 62.800 ## 3 1 0 0 0 46.800 ## 4 1 1 0 1 57.000 ## 5 2 1 0 0 59.800 ## 6 2 1 1 1 58.500 ## 7 2 0 0 1 55.500 ## 8 2 0 1 0 56.000 ## 9 3 0 1 0 62.800 ## 10 3 1 1 1 55.800 ## 11 3 1 0 0 69.500 ## 12 3 0 0 1 55.000 ## 13 4 1 0 0 62.000 ## 14 4 1 1 1 48.800 ## 15 4 0 0 1 45.500 ## 16 4 0 1 0 44.200 ## 17 5 1 1 0 52.000 ## 18 5 0 0 0 51.500 ## 19 5 1 0 1 49.800 ## 20 5 0 1 1 48.800 ## 21 6 1 0 1 57.200 ## 22 6 1 1 0 59.000 ## 23 6 0 1 1 53.200 ## 24 6 0 0 0 56.000 ## ────────────────────── #设置导出到doc中 #print_table(npk, file=&quot;&quot;) 3.3.4 model_summary：常用模型结果summary bruceR的model_summary可以对常见的线性非线性，生存分析，结构方程模型等整洁化结果输出。快速生成美观的结果，通过file参数导出到doc文件里 head(airquality, 5) ## Ozone Solar.R Wind Temp Month Day ## 1 41 190 7.4 67 5 1 ## 2 36 118 8.0 72 5 2 ## 3 12 149 12.6 74 5 3 ## 4 18 313 11.5 62 5 4 ## 5 NA NA 14.3 56 5 5 airquality %&gt;% lm(Temp ~ Month + Day + Wind + Solar.R,data=.)%&gt;% model_summary() ## ## Model Summary ## ## ──────────────────────── ## (1) Temp ## ──────────────────────── ## (Intercept) 68.770 *** ## (4.391) ## Month 2.225 *** ## (0.441) ## Day -0.084 ## (0.070) ## Wind -1.003 *** ## (0.176) ## Solar.R 0.027 *** ## (0.007) ## ──────────────────────── ## R^2 0.387 ## Adj. R^2 0.369 ## Num. obs. 146 ## ──────────────────────── ## Note. * p &lt; .05, ** p &lt; .01, *** p &lt; .001. ## ## # Check for Multicollinearity ## ## Low Correlation ## ## Term VIF VIF 95% CI Increased SE Tolerance Tolerance 95% CI ## Month 1.03 [1.00, 4.91] 1.02 0.97 [0.20, 1.00] ## Day 1.02 [1.00, 22.58] 1.01 0.98 [0.04, 1.00] ## Wind 1.03 [1.00, 6.15] 1.02 0.97 [0.16, 1.00] ## Solar.R 1.03 [1.00, 5.32] 1.02 0.97 [0.19, 1.00] 3.3.5 RECODE:recode重新编码 示例用的是datatable包，这个比较难暂时可以不用管 d = data.table(var=c(NA, 0, 1, 2, 3, 4, 5, 6)) d ## var ## &lt;num&gt; ## 1: NA ## 2: 0 ## 3: 1 ## 4: 2 ## 5: 3 ## 6: 4 ## 7: 5 ## 8: 6 d[, `:=`( var.new = RECODE(var, &quot;lo:1=0; c(2,3)=1; 4=2; 5:hi=3; else=999&quot;) )] d ## var var.new ## &lt;num&gt; &lt;num&gt; ## 1: NA 999 ## 2: 0 0 ## 3: 1 0 ## 4: 2 1 ## 5: 3 1 ## 6: 4 2 ## 7: 5 3 ## 8: 6 3 3.4 其它函数 作者应该是把日常能汇总的都汇总到了一起，函数太多了，方法面面都会用到 建议大家可以去作者 包寒吴霜 的知乎主页里学习一番，对r语言的提高大有裨益 "],["comparegroups-描述性表一快速生成.html", "4 compareGroups-描述性表一快速生成 4.1 R包介绍 4.2 R包安装 4.3 R包参数", " 4 compareGroups-描述性表一快速生成 第95期 R语言教程！compareGroups神包制作描述性表一 描述性表1在论文写作中占据着开篇起笔的作用。对所用的数据进行描述和简单分析，为后续的模型构建提供数据可靠性信息 本期介绍如何使用compareGroups神包来快速生成符合学术规范的表1。并进行包括以下自定义设置：1.设置亚组 2.设置非正态变量使用非参组间检验 3.设置显示缺失值 4.设置显示OR值 5.设置使用自定义组间比较方法 6 数据导出 4.1 R包介绍 compareGroups 是一个在 CRAN 上可用的 R 包，它可以生成描述性表格，展示几个变量的均值、标准差、分位数或频率。此外，还会使用适当的测试计算 p 值来检验组间差异。 通过简单的代码，就能在 R 中生成美观、规范且可直接用于论文发表的描述性表格。这些表格还可以导出到不同的格式，如 Word、Excel、PDF，或插入到 R-Sweave 或 R-markdown 文档中。 在手册 https://cran.r-project.org/web/packages/compareGroups/vignettes/compareGroups_vignette.html里提供了非常友好的R包教程，描述了 compareGroups 的所有功能，并附有实际示例。 4.2 R包安装 从CRAN中安装R包 install.packages(&quot;compareGroups&quot;) 或者从github安装最新版本 library(devtools) devtools::install_github(&quot;isubirana/compareGroups&quot;) 4.3 R包参数 4.3.1 查看数据 (不重要可以不看，知道是包含多种数据类型的数据集即可)调用R包自带的regicor数据，包含25个变量。regicor（吉罗纳心脏登记）研究是一项横断面研究，参与者来自西班牙东北部地区。在此研究中，收集了参与者的各种数据集，包括人口统计信息（如年龄和性别）、人体测量数据（如身高、体重和腰围）以及脂质水平（包括总胆固醇和甘油三酯）。此外，参与者还完成了涵盖体育活动和生活质量等领域的问卷。 为了追踪健康结果，研究还收集了关于心血管事件和死亡的数据。这些信息是通过医院和官方登记册及报告，在超过10年的时间里获得的。 library(compareGroups) library(bruceR) #之前有介绍过，方便描述数据 # 方便起见，我们只分析前十个变量 data(&quot;regicor&quot;) regicor &lt;- regicor[,1:10] str(regicor) ## &#39;data.frame&#39;: 2294 obs. of 10 variables: ## $ id : num 2.26e+03 1.88e+03 3.00e+09 3.00e+09 3.00e+09 ... ## ..- attr(*, &quot;label&quot;)= Named chr &quot;Individual id&quot; ## .. ..- attr(*, &quot;names&quot;)= chr &quot;id&quot; ## $ year : Factor w/ 3 levels &quot;1995&quot;,&quot;2000&quot;,..: 3 3 2 2 2 2 2 1 3 1 ... ## ..- attr(*, &quot;label&quot;)= Named chr &quot;Recruitment year&quot; ## .. ..- attr(*, &quot;names&quot;)= chr &quot;year&quot; ## $ age : int 70 56 37 69 70 40 66 53 43 70 ... ## ..- attr(*, &quot;label&quot;)= Named chr &quot;Age&quot; ## .. ..- attr(*, &quot;names&quot;)= chr &quot;age&quot; ## $ sex : Factor w/ 2 levels &quot;Male&quot;,&quot;Female&quot;: 2 2 1 2 2 2 1 2 2 1 ... ## ..- attr(*, &quot;label&quot;)= chr &quot;Sex&quot; ## $ smoker : Factor w/ 3 levels &quot;Never smoker&quot;,..: 1 1 2 1 NA 2 1 1 3 3 ... ## ..- attr(*, &quot;label&quot;)= Named chr &quot;Smoking status&quot; ## .. ..- attr(*, &quot;names&quot;)= chr &quot;smoker&quot; ## $ sbp : int 138 139 132 168 NA 108 120 132 95 142 ... ## ..- attr(*, &quot;label&quot;)= Named chr &quot;Systolic blood pressure&quot; ## .. ..- attr(*, &quot;names&quot;)= chr &quot;sbp&quot; ## $ dbp : int 75 89 82 97 NA 70 72 78 65 78 ... ## ..- attr(*, &quot;label&quot;)= Named chr &quot;Diastolic blood pressure&quot; ## .. ..- attr(*, &quot;names&quot;)= chr &quot;dbp&quot; ## $ histhtn: Factor w/ 2 levels &quot;Yes&quot;,&quot;No&quot;: 2 2 2 2 2 2 1 2 2 2 ... ## ..- attr(*, &quot;label&quot;)= Named chr &quot;History of hypertension&quot; ## .. ..- attr(*, &quot;names&quot;)= chr &quot;histbp&quot; ## $ txhtn : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 2 1 1 1 ... ## ..- attr(*, &quot;label&quot;)= chr &quot;Hypertension treatment&quot; ## $ chol : num 294 220 245 168 NA NA 298 254 194 188 ... ## ..- attr(*, &quot;label&quot;)= Named chr &quot;Total cholesterol&quot; ## .. ..- attr(*, &quot;names&quot;)= chr &quot;chol&quot; 4.3.2 生成描述性统计表 简单生成一个最简单的描述性统计表，发现定量资料用平均值标准差描述，分类资料用例数和占比描述 descrTable( ~ ., data = regicor) ## ## --------Summary descriptives table --------- ## ## _______________________________________________________ ## [ALL] N ## N=2294 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ## Individual id 1215817624 (1339538686) 2294 ## Recruitment year: 2294 ## 1995 431 (18.8%) ## 2000 786 (34.3%) ## 2005 1077 (46.9%) ## Age 54.7 (11.0) 2294 ## Sex: 2294 ## Male 1101 (48.0%) ## Female 1193 (52.0%) ## Smoking status: 2233 ## Never smoker 1201 (53.8%) ## Current or former &lt; 1y 593 (26.6%) ## Former &gt;= 1y 439 (19.7%) ## Systolic blood pressure 131 (20.3) 2280 ## Diastolic blood pressure 79.7 (10.5) 2280 ## History of hypertension: 2286 ## Yes 723 (31.6%) ## No 1563 (68.4%) ## Hypertension treatment: 2251 ## No 1823 (81.0%) ## Yes 428 (19.0%) ## Total cholesterol 219 (45.2) 2193 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 4.3.3 设置分组变量 根据吸烟情况将人群分为三组，同时生成组间比较列（p.overall）。自动使用卡方检验(分类变量)和方差分析(计量资料：两类时等价t检验)。 descrTable(`smoker`~ ., data = regicor) ## ## --------Summary descriptives table by &#39;Smoking status&#39;--------- ## ## _________________________________________________________________________________________________________ ## Never smoker Current or former &lt; 1y Former &gt;= 1y p.overall ## N=1201 N=593 N=439 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ## Individual id 1229013133 (1337342152) 1534618659 (1372769742) 690225475 (1126583145) &lt;0.001 ## Recruitment year: &lt;0.001 ## 1995 234 (19.5%) 109 (18.4%) 72 (16.4%) ## 2000 414 (34.5%) 267 (45.0%) 77 (17.5%) ## 2005 553 (46.0%) 217 (36.6%) 290 (66.1%) ## Age 56.5 (10.8) 50.6 (10.7) 55.3 (10.6) &lt;0.001 ## Sex: &lt;0.001 ## Male 301 (25.1%) 410 (69.1%) 360 (82.0%) ## Female 900 (74.9%) 183 (30.9%) 79 (18.0%) ## Systolic blood pressure 132 (20.5) 128 (19.8) 133 (19.7) &lt;0.001 ## Diastolic blood pressure 79.5 (10.2) 78.8 (11.0) 81.2 (10.8) 0.001 ## History of hypertension: &lt;0.001 ## Yes 421 (35.1%) 125 (21.2%) 162 (36.9%) ## No 777 (64.9%) 464 (78.8%) 277 (63.1%) ## Hypertension treatment: &lt;0.001 ## No 922 (77.9%) 525 (90.2%) 331 (77.2%) ## Yes 262 (22.1%) 57 (9.79%) 98 (22.8%) ## Total cholesterol 220 (46.7) 219 (44.7) 214 (42.6) 0.039 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 4.3.4 删除某些变量不显示 如不希望描述性统计对Id和year进行描述，直接在~右侧的.后使用减号进行删除（如需要的变量比较少，也可以手动写公式一个个加） descrTable(`smoker`~ .-id-year, data = regicor) ## ## --------Summary descriptives table by &#39;Smoking status&#39;--------- ## ## ___________________________________________________________________________________ ## Never smoker Current or former &lt; 1y Former &gt;= 1y p.overall ## N=1201 N=593 N=439 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ## Age 56.5 (10.8) 50.6 (10.7) 55.3 (10.6) &lt;0.001 ## Sex: &lt;0.001 ## Male 301 (25.1%) 410 (69.1%) 360 (82.0%) ## Female 900 (74.9%) 183 (30.9%) 79 (18.0%) ## Systolic blood pressure 132 (20.5) 128 (19.8) 133 (19.7) &lt;0.001 ## Diastolic blood pressure 79.5 (10.2) 78.8 (11.0) 81.2 (10.8) 0.001 ## History of hypertension: &lt;0.001 ## Yes 421 (35.1%) 125 (21.2%) 162 (36.9%) ## No 777 (64.9%) 464 (78.8%) 277 (63.1%) ## Hypertension treatment: &lt;0.001 ## No 922 (77.9%) 525 (90.2%) 331 (77.2%) ## Yes 262 (22.1%) 57 (9.79%) 98 (22.8%) ## Total cholesterol 220 (46.7) 219 (44.7) 214 (42.6) 0.039 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 4.3.5 亚组描述 subset=(逻辑判断)来挑选出男性患者进行分析 descrTable(`smoker`~ .-id-year-sex, data = regicor, subset=(sex==&quot;Male&quot;)) ## ## --------Summary descriptives table by &#39;smoker&#39;--------- ## ## ___________________________________________________________________________________ ## Never smoker Current or former &lt; 1y Former &gt;= 1y p.overall ## N=301 N=410 N=360 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ## Age 55.0 (11.5) 52.7 (11.0) 56.8 (10.5) &lt;0.001 ## Systolic blood pressure 133 (18.5) 133 (19.0) 136 (19.0) 0.048 ## Diastolic blood pressure 81.3 (9.31) 81.2 (10.6) 82.3 (10.4) 0.253 ## History of hypertension: &lt;0.001 ## Yes 85 (28.4%) 101 (24.8%) 145 (40.3%) ## No 214 (71.6%) 306 (75.2%) 215 (59.7%) ## Hypertension treatment: &lt;0.001 ## No 248 (83.5%) 357 (88.4%) 263 (75.1%) ## Yes 49 (16.5%) 47 (11.6%) 87 (24.9%) ## Total cholesterol 213 (44.0) 221 (41.9) 216 (43.3) 0.061 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 4.3.6 自定义设置分组检验方法 设置mehtod参数值，如果不设置，默认所有变量符合正态分布。修改age为非正态后使用四分位数进行描述，同时使用非参检验进行分组比较 参数值为1：正态分布分析 ：此值强制分析假设行变量遵循正态分布。 参数值为2：连续非正态分析 ：选择此值意味着分析不假设行变量遵循正态分布，将其视为连续但非正态分布的变量。 参数值为3：分类分析：此值强制分析将行变量视为分类变量，无论其原始类型如何。 参数值为4：Shapiro-Wilks检验 （正态检验）：使用此值触发Shapiro-Wilks检验，以确定变量是否应在正态性假设下进行分析，还是非正态。这对于根据数据做出如何处理每个变量的决策非常有用。 # descrTable(`smoker`~ .-id-year, data = regicor,method = 1) 假定所有变量符合正态分布 #设置age变量为非正态，使用非参检验进行比较 descrTable(`sex`~ .-id-year, data = regicor, method=c(age = 2)) ## ## --------Summary descriptives table by &#39;Sex&#39;--------- ## ## ______________________________________________________________________ ## Male Female p.overall ## N=1101 N=1193 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ## Age 54.0 [46.0;64.0] 55.0 [46.0;64.0] 0.851 ## Smoking status: &lt;0.001 ## Never smoker 301 (28.1%) 900 (77.5%) ## Current or former &lt; 1y 410 (38.3%) 183 (15.7%) ## Former &gt;= 1y 360 (33.6%) 79 (6.80%) ## Systolic blood pressure 134 (18.9) 129 (21.2) &lt;0.001 ## Diastolic blood pressure 81.7 (10.2) 77.8 (10.5) &lt;0.001 ## History of hypertension: 0.644 ## Yes 341 (31.1%) 382 (32.1%) ## No 755 (68.9%) 808 (67.9%) ## Hypertension treatment: 0.096 ## No 889 (82.5%) 934 (79.6%) ## Yes 189 (17.5%) 239 (20.4%) ## Total cholesterol 217 (42.7) 220 (47.4) 0.140 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 4.3.7 不显示标签label值 有些数据集自带label，可以通过include.label设置是否显示标签 descrTable(`sex`~ .-id-year, data = regicor, include.label= FALSE) ## ## --------Summary descriptives table by &#39;sex&#39;--------- ## ## ____________________________________________________________ ## Male Female p.overall ## N=1101 N=1193 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ## age 54.8 (11.1) 54.7 (11.0) 0.840 ## smoker: &lt;0.001 ## Never smoker 301 (28.1%) 900 (77.5%) ## Current or former &lt; 1y 410 (38.3%) 183 (15.7%) ## Former &gt;= 1y 360 (33.6%) 79 (6.80%) ## sbp 134 (18.9) 129 (21.2) &lt;0.001 ## dbp 81.7 (10.2) 77.8 (10.5) &lt;0.001 ## histhtn: 0.644 ## Yes 341 (31.1%) 382 (32.1%) ## No 755 (68.9%) 808 (67.9%) ## txhtn: 0.096 ## No 889 (82.5%) 934 (79.6%) ## Yes 189 (17.5%) 239 (20.4%) ## chol 217 (42.7) 220 (47.4) 0.140 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 4.3.8 设置计量资料用四分位法描述 设置Q1参数和Q3参数设置如何描述非正态连续变量。如果设置成0和1就是最小值最大值描述 descrTable(`sex`~ .-id-year, data = regicor,method = c(age=2), Q1=0.025, Q3=0.975) ## ## --------Summary descriptives table by &#39;Sex&#39;--------- ## ## ______________________________________________________________________ ## Male Female p.overall ## N=1101 N=1193 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ## Age 54.0 [36.0;73.0] 55.0 [36.0;73.0] 0.851 ## Smoking status: &lt;0.001 ## Never smoker 301 (28.1%) 900 (77.5%) ## Current or former &lt; 1y 410 (38.3%) 183 (15.7%) ## Former &gt;= 1y 360 (33.6%) 79 (6.80%) ## Systolic blood pressure 134 (18.9) 129 (21.2) &lt;0.001 ## Diastolic blood pressure 81.7 (10.2) 77.8 (10.5) &lt;0.001 ## History of hypertension: 0.644 ## Yes 341 (31.1%) 382 (32.1%) ## No 755 (68.9%) 808 (67.9%) ## Hypertension treatment: 0.096 ## No 889 (82.5%) 934 (79.6%) ## Yes 189 (17.5%) 239 (20.4%) ## Total cholesterol 217 (42.7) 220 (47.4) 0.140 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 4.3.9 生成OR和HR值 使用show.ratio变量来显示OR值，对于变量类型是time-to-event变量则输出HR值 descrTable(`sex`~ .-id-year, data = regicor,show.ratio = TRUE) ## ## --------Summary descriptives table by &#39;Sex&#39;--------- ## ## _____________________________________________________________________________________ ## Male Female OR p.ratio p.overall ## N=1101 N=1193 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ## Age 54.8 (11.1) 54.7 (11.0) 1.00 [0.99;1.01] 0.840 0.840 ## Smoking status: &lt;0.001 ## Never smoker 301 (28.1%) 900 (77.5%) Ref. Ref. ## Current or former &lt; 1y 410 (38.3%) 183 (15.7%) 0.15 [0.12;0.19] 0.000 ## Former &gt;= 1y 360 (33.6%) 79 (6.80%) 0.07 [0.06;0.10] 0.000 ## Systolic blood pressure 134 (18.9) 129 (21.2) 0.99 [0.98;0.99] &lt;0.001 &lt;0.001 ## Diastolic blood pressure 81.7 (10.2) 77.8 (10.5) 0.96 [0.96;0.97] &lt;0.001 &lt;0.001 ## History of hypertension: 0.644 ## Yes 341 (31.1%) 382 (32.1%) Ref. Ref. ## No 755 (68.9%) 808 (67.9%) 0.96 [0.80;1.14] 0.612 ## Hypertension treatment: 0.096 ## No 889 (82.5%) 934 (79.6%) Ref. Ref. ## Yes 189 (17.5%) 239 (20.4%) 1.20 [0.97;1.49] 0.086 ## Total cholesterol 217 (42.7) 220 (47.4) 1.00 [1.00;1.00] 0.141 0.140 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 4.3.9.1 设置OR值的ref对照 使用ref参数设置变量的ref对照值。代码所示为把smoker的因子level为3（值为”Former&gt;=1y”）的设置为对照组计算其它组的OR值 同样作用的函数还有ref.no 和 ref.y descrTable(`sex`~ .-id-year, data = regicor, include.label = FALSE,show.ratio = TRUE, ref = c(smoker=3)) ## ## --------Summary descriptives table by &#39;sex&#39;--------- ## ## _____________________________________________________________________________________ ## Male Female OR p.ratio p.overall ## N=1101 N=1193 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ## age 54.8 (11.1) 54.7 (11.0) 1.00 [0.99;1.01] 0.840 0.840 ## smoker: &lt;0.001 ## Never smoker 301 (28.1%) 900 (77.5%) 13.6 [10.4;18.0] 0.000 ## Current or former &lt; 1y 410 (38.3%) 183 (15.7%) 2.03 [1.51;2.75] &lt;0.001 ## Former &gt;= 1y 360 (33.6%) 79 (6.80%) Ref. Ref. ## sbp 134 (18.9) 129 (21.2) 0.99 [0.98;0.99] &lt;0.001 &lt;0.001 ## dbp 81.7 (10.2) 77.8 (10.5) 0.96 [0.96;0.97] &lt;0.001 &lt;0.001 ## histhtn: 0.644 ## Yes 341 (31.1%) 382 (32.1%) Ref. Ref. ## No 755 (68.9%) 808 (67.9%) 0.96 [0.80;1.14] 0.612 ## txhtn: 0.096 ## No 889 (82.5%) 934 (79.6%) Ref. Ref. ## Yes 189 (17.5%) 239 (20.4%) 1.20 [0.97;1.49] 0.086 ## chol 217 (42.7) 220 (47.4) 1.00 [1.00;1.00] 0.141 0.140 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 4.3.10 不显示对照组的描述信息 使用hide.no来隐藏某些因子水平的描述。常用来隐藏掉2分类变量的否的信息 descrTable(`sex`~ .-id-year, data = regicor,hide.no = &quot;No&quot;) ## ## --------Summary descriptives table by &#39;Sex&#39;--------- ## ## ____________________________________________________________ ## Male Female p.overall ## N=1101 N=1193 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ## Age 54.8 (11.1) 54.7 (11.0) 0.840 ## Smoking status: &lt;0.001 ## Never smoker 301 (28.1%) 900 (77.5%) ## Current or former &lt; 1y 410 (38.3%) 183 (15.7%) ## Former &gt;= 1y 360 (33.6%) 79 (6.80%) ## Systolic blood pressure 134 (18.9) 129 (21.2) &lt;0.001 ## Diastolic blood pressure 81.7 (10.2) 77.8 (10.5) &lt;0.001 ## History of hypertension 341 (31.1%) 382 (32.1%) 0.644 ## Hypertension treatment 189 (17.5%) 239 (20.4%) 0.096 ## Total cholesterol 217 (42.7) 220 (47.4) 0.140 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 4.3.11 同时显示总人群的描述 descrTable(`sex`~ .-id-year, data = regicor,show.all = TRUE) ## ## --------Summary descriptives table by &#39;Sex&#39;--------- ## ## _________________________________________________________________________ ## [ALL] Male Female p.overall ## N=2294 N=1101 N=1193 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ ## Age 54.7 (11.0) 54.8 (11.1) 54.7 (11.0) 0.840 ## Smoking status: &lt;0.001 ## Never smoker 1201 (53.8%) 301 (28.1%) 900 (77.5%) ## Current or former &lt; 1y 593 (26.6%) 410 (38.3%) 183 (15.7%) ## Former &gt;= 1y 439 (19.7%) 360 (33.6%) 79 (6.80%) ## Systolic blood pressure 131 (20.3) 134 (18.9) 129 (21.2) &lt;0.001 ## Diastolic blood pressure 79.7 (10.5) 81.7 (10.2) 77.8 (10.5) &lt;0.001 ## History of hypertension: 0.644 ## Yes 723 (31.6%) 341 (31.1%) 382 (32.1%) ## No 1563 (68.4%) 755 (68.9%) 808 (67.9%) ## Hypertension treatment: 0.096 ## No 1823 (81.0%) 889 (82.5%) 934 (79.6%) ## Yes 428 (19.0%) 189 (17.5%) 239 (20.4%) ## Total cholesterol 219 (45.2) 217 (42.7) 220 (47.4) 0.140 ## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 4.3.12 结果导出 可导出各种格式,export2xls, export2latex, export2pdf, export2csv, export2md, export2word export2word(tab_0,file=&quot;1 data_summary.docx&quot;) 4.3.13 快速可视化 使用plot函数进行可视化，设置file和type参数进行保存例如 plot(res[c(1,2)], file=“./figures/univar/”, type=“png”) tab0 &lt;- descrTable(`sex`~ .-id-year, data = regicor) plot(tab0) "],["scitb-快速生成基线表一.html", "5 scitb-快速生成基线表一 5.1 R包介绍 5.2 R包安装 5.3 R包使用 5.4 总结", " 5 scitb-快速生成基线表一 5.1 R包介绍 scitb是一个专门用于基线表开发的包，相较于tableone scitb具有更好使用，导出方便，快速设置的优点 CRAN库 作者教程 5.2 R包安装 install.packages(&quot;scitb&quot;) 5.3 R包使用 5.3.1 导入示例数据 导入数据prematurity，：low 是否是小于2500g早产低体重儿，age 母亲的年龄，lwt 末次月经体重，race 种族，smoke孕期抽烟，ptl 早产史（计数），ht 有高血压病史，ui 子宫过敏，ftv 早孕时看医生的次数bwt 新生儿体重数值 library(scitb) library(bruceR) ## ## bruceR (v2024.6) ## Broadly Useful Convenient and Efficient R functions ## ## Packages also loaded: ## ✔ data.table ✔ emmeans ## ✔ dplyr ✔ lmerTest ## ✔ tidyr ✔ effectsize ## ✔ stringr ✔ performance ## ✔ ggplot2 ✔ interactions ## ## Main functions of `bruceR`: ## cc() Describe() TTEST() ## add() Freq() MANOVA() ## .mean() Corr() EMMEANS() ## set.wd() Alpha() PROCESS() ## import() EFA() model_summary() ## print_table() CFA() lavaan_summary() ## ## For full functionality, please install all dependencies: ## install.packages(&quot;bruceR&quot;, dep=TRUE) ## ## Online documentation: ## https://psychbruce.github.io/bruceR ## ## To use this package in publications, please cite: ## Bao, H.-W.-S. (2024). bruceR: Broadly useful convenient and efficient R functions (Version 2024.6) [Computer software]. https://CRAN.R-project.org/package=bruceR data &lt;- prematurity head(data,5) ## id low age lwt race smoke ptl ht ui ftv bwt ## 1 85 0 19 182 black nonsmoker 0 0 1 0 2523 ## 2 86 0 33 155 other nonsmoker 0 0 0 3 2551 ## 3 87 0 20 105 white smoker 0 0 0 1 2557 ## 4 88 0 21 108 white smoker 0 0 1 2 2594 ## 5 89 0 18 107 white smoker 0 0 1 0 2600 5.3.2 生成描述性表1 5.3.2.1 首先定义变量 为什么这里要定义变量，而不在基线表函数里直接引入字符向量，这是为了有良好的编程习惯。先从构建函数框架开始，最后函数调用，后续无论是修改变量还是增删变量都会很清晰 allVars&lt;-c(&quot;low&quot;,&quot;age&quot;,&quot;lwt&quot;,&quot;race&quot;,&quot;smoke&quot;,&quot;ptl&quot;,&quot;ht&quot;,&quot;ui&quot;,&quot;ftv&quot;,&quot;bwt&quot;) fvars&lt;-c(&quot;low&quot;,&quot;race&quot;,&quot;smoke&quot;,&quot;ptl&quot;,&quot;ht&quot;,&quot;ui&quot;,&quot;ftv&quot;) strata&lt;-c(&quot;bwt&quot;) 5.3.2.2 生成基线表 data_neat &lt;- data |&gt; mutate( race = as.factor(race), smoke = as.factor(smoke) ) tab0&lt;-scitb1(vars=allVars,fvars=fvars,strata=strata,data=data_neat) ## Min 33.33333% 66.66667% Max ## 709.000 2598.000 3283.667 4990.000 ## Strata is treated as a continuous variable. tab0 ## Characteristic G.0 G.1 ## scinn &quot;N&quot; &quot;63&quot; &quot;63&quot; ## d1 &quot;age&quot; &quot;22.00 (19.50-25.00)&quot; &quot;23.00 (19.00-28.00)&quot; ## d1 &quot;lwt&quot; &quot;120.00 (105.00-131.00)&quot; &quot;120.00 (109.50-132.50)&quot; ## d1 &quot;bwt&quot; &quot;2126.24±394.60&quot; &quot;2969.94±190.20&quot; ## d2 &quot;low&quot; &quot; &quot; &quot; &quot; ## &quot;0&quot; &quot; 4 (6.35%)&quot; &quot;63 (100.00%)&quot; ## &quot;1&quot; &quot;59 (93.65%)&quot; &quot; 0 (0.00%)&quot; ## d2 &quot;race&quot; &quot; &quot; &quot; &quot; ## &quot;black&quot; &quot;12 (19.05%)&quot; &quot; 8 (12.70%)&quot; ## &quot;other&quot; &quot;26 (41.27%)&quot; &quot;25 (39.68%)&quot; ## &quot;white&quot; &quot;25 (39.68%)&quot; &quot;30 (47.62%)&quot; ## d2 &quot;smoke&quot; &quot; &quot; &quot; &quot; ## &quot;nonsmoker&quot; &quot;31 (49.21%)&quot; &quot;39 (61.90%)&quot; ## &quot;smoker&quot; &quot;32 (50.79%)&quot; &quot;24 (38.10%)&quot; ## d2 &quot;ptl&quot; &quot; &quot; &quot; &quot; ## &quot;0&quot; &quot;45 (71.43%)&quot; &quot;58 (92.06%)&quot; ## &quot;1&quot; &quot;16 (25.40%)&quot; &quot; 4 (6.35%)&quot; ## &quot;2&quot; &quot; 2 (3.17%)&quot; &quot; 1 (1.59%)&quot; ## &quot;3&quot; &quot; 0 (0.00%)&quot; &quot; 0 (0.00%)&quot; ## d2 &quot;ht&quot; &quot; &quot; &quot; &quot; ## &quot;0&quot; &quot;56 (88.89%)&quot; &quot;61 (96.83%)&quot; ## &quot;1&quot; &quot; 7 (11.11%)&quot; &quot; 2 (3.17%)&quot; ## d2 &quot;ui&quot; &quot; &quot; &quot; &quot; ## &quot;0&quot; &quot;47 (74.60%)&quot; &quot;54 (85.71%)&quot; ## &quot;1&quot; &quot;16 (25.40%)&quot; &quot; 9 (14.29%)&quot; ## d2 &quot;ftv&quot; &quot; &quot; &quot; &quot; ## &quot;0&quot; &quot;37 (58.73%)&quot; &quot;32 (50.79%)&quot; ## &quot;1&quot; &quot;12 (19.05%)&quot; &quot;15 (23.81%)&quot; ## &quot;2&quot; &quot; 8 (12.70%)&quot; &quot;13 (20.63%)&quot; ## &quot;3&quot; &quot; 5 (7.94%)&quot; &quot; 2 (3.17%)&quot; ## &quot;4&quot; &quot; 1 (1.59%)&quot; &quot; 1 (1.59%)&quot; ## &quot;6&quot; &quot; 0 (0.00%)&quot; &quot; 0 (0.00%)&quot; ## G.2 p value ## scinn &quot;63&quot; &quot;&quot; ## d1 &quot;23.00 (19.50-28.00)&quot; &quot;0.483&quot; ## d1 &quot;131.00 (120.00-156.00)&quot; &quot;&lt;0.001&quot; ## d1 &quot;3736.68±317.76&quot; &quot;&lt;0.001&quot; ## d2 &quot; &quot; &quot;&lt;0.001&quot; ## &quot;63 (100.00%)&quot; &quot; &quot; ## &quot; 0 (0.00%)&quot; &quot; &quot; ## d2 &quot; &quot; &quot;0.060&quot; ## &quot; 6 (9.52%)&quot; &quot; &quot; ## &quot;16 (25.40%)&quot; &quot; &quot; ## &quot;41 (65.08%)&quot; &quot; &quot; ## d2 &quot; &quot; &quot;0.037&quot; ## &quot;45 (71.43%)&quot; &quot; &quot; ## &quot;18 (28.57%)&quot; &quot; &quot; ## d2 &quot; &quot; &quot;0.012&quot; ## &quot;56 (88.89%)&quot; &quot; &quot; ## &quot; 4 (6.35%)&quot; &quot; &quot; ## &quot; 2 (3.17%)&quot; &quot; &quot; ## &quot; 1 (1.59%)&quot; &quot; &quot; ## d2 &quot; &quot; &quot;0.154&quot; ## &quot;60 (95.24%)&quot; &quot; &quot; ## &quot; 3 (4.76%)&quot; &quot; &quot; ## d2 &quot; &quot; &quot;0.005&quot; ## &quot;60 (95.24%)&quot; &quot; &quot; ## &quot; 3 (4.76%)&quot; &quot; &quot; ## d2 &quot; &quot; &quot;0.283&quot; ## &quot;31 (49.21%)&quot; &quot; &quot; ## &quot;20 (31.75%)&quot; &quot; &quot; ## &quot; 9 (14.29%)&quot; &quot; &quot; ## &quot; 0 (0.00%)&quot; &quot; &quot; ## &quot; 2 (3.17%)&quot; &quot; &quot; ## &quot; 1 (1.59%)&quot; &quot; &quot; 5.3.2.3 设置有非正态资料 设置非正态后可以看到lwt变量是用百分位数进行描述，后边的pvalue也调用非参检验 tab2 &lt;-scitb1(vars=allVars,fvars=fvars,strata=strata,data=data_neat, nonnormal=c(&quot;lwt&quot;)) ## Min 33.33333% 66.66667% Max ## 709.000 2598.000 3283.667 4990.000 ## Strata is treated as a continuous variable. tab2 ## Characteristic G.0 G.1 ## scinn &quot;N&quot; &quot;63&quot; &quot;63&quot; ## d1 &quot;age&quot; &quot;22.00 (19.50-25.00)&quot; &quot;23.00 (19.00-28.00)&quot; ## d1 &quot;lwt&quot; &quot;120.00 (105.00-131.00)&quot; &quot;120.00 (109.50-132.50)&quot; ## d1 &quot;bwt&quot; &quot;2126.24±394.60&quot; &quot;2969.94±190.20&quot; ## d2 &quot;low&quot; &quot; &quot; &quot; &quot; ## &quot;0&quot; &quot; 4 (6.35%)&quot; &quot;63 (100.00%)&quot; ## &quot;1&quot; &quot;59 (93.65%)&quot; &quot; 0 (0.00%)&quot; ## d2 &quot;race&quot; &quot; &quot; &quot; &quot; ## &quot;black&quot; &quot;12 (19.05%)&quot; &quot; 8 (12.70%)&quot; ## &quot;other&quot; &quot;26 (41.27%)&quot; &quot;25 (39.68%)&quot; ## &quot;white&quot; &quot;25 (39.68%)&quot; &quot;30 (47.62%)&quot; ## d2 &quot;smoke&quot; &quot; &quot; &quot; &quot; ## &quot;nonsmoker&quot; &quot;31 (49.21%)&quot; &quot;39 (61.90%)&quot; ## &quot;smoker&quot; &quot;32 (50.79%)&quot; &quot;24 (38.10%)&quot; ## d2 &quot;ptl&quot; &quot; &quot; &quot; &quot; ## &quot;0&quot; &quot;45 (71.43%)&quot; &quot;58 (92.06%)&quot; ## &quot;1&quot; &quot;16 (25.40%)&quot; &quot; 4 (6.35%)&quot; ## &quot;2&quot; &quot; 2 (3.17%)&quot; &quot; 1 (1.59%)&quot; ## &quot;3&quot; &quot; 0 (0.00%)&quot; &quot; 0 (0.00%)&quot; ## d2 &quot;ht&quot; &quot; &quot; &quot; &quot; ## &quot;0&quot; &quot;56 (88.89%)&quot; &quot;61 (96.83%)&quot; ## &quot;1&quot; &quot; 7 (11.11%)&quot; &quot; 2 (3.17%)&quot; ## d2 &quot;ui&quot; &quot; &quot; &quot; &quot; ## &quot;0&quot; &quot;47 (74.60%)&quot; &quot;54 (85.71%)&quot; ## &quot;1&quot; &quot;16 (25.40%)&quot; &quot; 9 (14.29%)&quot; ## d2 &quot;ftv&quot; &quot; &quot; &quot; &quot; ## &quot;0&quot; &quot;37 (58.73%)&quot; &quot;32 (50.79%)&quot; ## &quot;1&quot; &quot;12 (19.05%)&quot; &quot;15 (23.81%)&quot; ## &quot;2&quot; &quot; 8 (12.70%)&quot; &quot;13 (20.63%)&quot; ## &quot;3&quot; &quot; 5 (7.94%)&quot; &quot; 2 (3.17%)&quot; ## &quot;4&quot; &quot; 1 (1.59%)&quot; &quot; 1 (1.59%)&quot; ## &quot;6&quot; &quot; 0 (0.00%)&quot; &quot; 0 (0.00%)&quot; ## G.2 p value ## scinn &quot;63&quot; &quot;&quot; ## d1 &quot;23.00 (19.50-28.00)&quot; &quot;0.483&quot; ## d1 &quot;131.00 (120.00-156.00)&quot; &quot;&lt;0.001&quot; ## d1 &quot;3736.68±317.76&quot; &quot;&lt;0.001&quot; ## d2 &quot; &quot; &quot;&lt;0.001&quot; ## &quot;63 (100.00%)&quot; &quot; &quot; ## &quot; 0 (0.00%)&quot; &quot; &quot; ## d2 &quot; &quot; &quot;0.060&quot; ## &quot; 6 (9.52%)&quot; &quot; &quot; ## &quot;16 (25.40%)&quot; &quot; &quot; ## &quot;41 (65.08%)&quot; &quot; &quot; ## d2 &quot; &quot; &quot;0.037&quot; ## &quot;45 (71.43%)&quot; &quot; &quot; ## &quot;18 (28.57%)&quot; &quot; &quot; ## d2 &quot; &quot; &quot;0.012&quot; ## &quot;56 (88.89%)&quot; &quot; &quot; ## &quot; 4 (6.35%)&quot; &quot; &quot; ## &quot; 2 (3.17%)&quot; &quot; &quot; ## &quot; 1 (1.59%)&quot; &quot; &quot; ## d2 &quot; &quot; &quot;0.154&quot; ## &quot;60 (95.24%)&quot; &quot; &quot; ## &quot; 3 (4.76%)&quot; &quot; &quot; ## d2 &quot; &quot; &quot;0.005&quot; ## &quot;60 (95.24%)&quot; &quot; &quot; ## &quot; 3 (4.76%)&quot; &quot; &quot; ## d2 &quot; &quot; &quot;0.283&quot; ## &quot;31 (49.21%)&quot; &quot; &quot; ## &quot;20 (31.75%)&quot; &quot; &quot; ## &quot; 9 (14.29%)&quot; &quot; &quot; ## &quot; 0 (0.00%)&quot; &quot; &quot; ## &quot; 2 (3.17%)&quot; &quot; &quot; ## &quot; 1 (1.59%)&quot; &quot; &quot; 5.3.3 连续变量快速分层描述 输出1可以看出年龄的自动分层记录，表明从14到20到25到45进行了分层 如果想要生成其它分层数，设置参数 num = n # allvar删不删除年龄都可以 allVars3 &lt;-c(&quot;race&quot;, &quot;lwt&quot;,&quot;smoke&quot;, &quot;ptl&quot;, &quot;ht&quot;, &quot;ui&quot;,&quot;ftv&quot;, &quot;bwt&quot;) fvars3 &lt;-c(&quot;smoke&quot;,&quot;ht&quot;,&quot;ui&quot;,&quot;race&quot;) strata3 &lt;- &quot;age&quot; tab3 &lt;-scitb1(vars=allVars3,fvars=fvars3,strata=strata3,data=data_neat) ## Min 33.33333% 66.66667% Max ## 14 20 25 45 ## Strata is treated as a continuous variable. tab3 ## Characteristic G.0 G.1 ## scinn &quot;N&quot; &quot;51&quot; &quot;69&quot; ## d1 &quot;lwt&quot; &quot;119.00 (106.00-135.00)&quot; &quot;121.00 (110.00-132.00)&quot; ## d1 &quot;ptl&quot; &quot;0.00 (0.00-0.00)&quot; &quot;0.00 (0.00-0.00)&quot; ## d1 &quot;ftv&quot; &quot;0.00 (0.00-1.00)&quot; &quot;0.00 (0.00-1.00)&quot; ## d1 &quot;bwt&quot; &quot;2974.08±612.51&quot; &quot;2921.42±697.85&quot; ## d2 &quot;smoke&quot; &quot; &quot; &quot; &quot; ## &quot;nonsmoker&quot; &quot;28 (54.90%)&quot; &quot;44 (63.77%)&quot; ## &quot;smoker&quot; &quot;23 (45.10%)&quot; &quot;25 (36.23%)&quot; ## d2 &quot;ht&quot; &quot; &quot; &quot; &quot; ## &quot;0&quot; &quot;48 (94.12%)&quot; &quot;64 (92.75%)&quot; ## &quot;1&quot; &quot; 3 (5.88%)&quot; &quot; 5 (7.25%)&quot; ## d2 &quot;ui&quot; &quot; &quot; &quot; &quot; ## &quot;0&quot; &quot;43 (84.31%)&quot; &quot;58 (84.06%)&quot; ## &quot;1&quot; &quot; 8 (15.69%)&quot; &quot;11 (15.94%)&quot; ## d2 &quot;race&quot; &quot; &quot; &quot; &quot; ## &quot;black&quot; &quot;10 (19.61%)&quot; &quot;10 (14.49%)&quot; ## &quot;other&quot; &quot;18 (35.29%)&quot; &quot;27 (39.13%)&quot; ## &quot;white&quot; &quot;23 (45.10%)&quot; &quot;32 (46.38%)&quot; ## G.2 p value ## scinn &quot;69&quot; &quot;&quot; ## d1 &quot;130.00 (115.00-153.00)&quot; &quot;0.086&quot; ## d1 &quot;0.00 (0.00-0.00)&quot; &quot;0.171&quot; ## d1 &quot;1.00 (0.00-2.00)&quot; &quot;0.011&quot; ## d1 &quot;2945.13±839.82&quot; &quot;0.927&quot; ## d2 &quot; &quot; &quot;0.587&quot; ## &quot;43 (62.32%)&quot; &quot; &quot; ## &quot;26 (37.68%)&quot; &quot; &quot; ## d2 &quot; &quot; &quot;0.929&quot; ## &quot;65 (94.20%)&quot; &quot; &quot; ## &quot; 4 (5.80%)&quot; &quot; &quot; ## d2 &quot; &quot; &quot;0.873&quot; ## &quot;60 (86.96%)&quot; &quot; &quot; ## &quot; 9 (13.04%)&quot; &quot; &quot; ## d2 &quot; &quot; &quot;0.320&quot; ## &quot; 6 (8.70%)&quot; &quot; &quot; ## &quot;22 (31.88%)&quot; &quot; &quot; ## &quot;41 (59.42%)&quot; &quot; &quot; 5.3.4 保存结果 write.csv(tab0,file= &quot;01-attch\\\\10\\\\data.csv&quot;,row.names = F, fileEncoding = &quot;gbk&quot;) 保存出来是下图，复制到word改改就能用 5.4 总结 使用体验：自定义度，结果展示等不如comparegroups，但是胜在参数简单，在期刊没那么高要求和平时展示可以用 "],["purrr-函数式编程彻底摆脱for循环.html", "6 purrr: 函数式编程,彻底摆脱for循环 6.1 R包介绍 6.2 R包安装 6.3 语法 6.4 举个栗子 6.5 多变量索引循环 6.6 嵌套循环 6.7 更多", " 6 purrr: 函数式编程,彻底摆脱for循环 6.1 R包介绍 purrr 通过提供一套完整且一致的用于处理函数和向量的工具来增强 R 的函数式编程 (FP) 工具包。如果您以前从未听说过 FP，那么最好的起点是map()函数系列，它允许您用更简洁、更易于阅读的代码替换许多 for 循环。 听起来有点复杂，但更简单来说，就是用嵌套函数来替代for循环的冗长的框架结构。让输入输出更简单。 相关教程：官网网站 6.2 R包安装 install.packages(&quot;purrr&quot;) 6.3 语法 purrr系列函数都以map，map2和pmap作为大类，搭配更多的后缀来设定输出类型。 map(.x, .f)：输入一个向量(.x)，以该向量为输入进行循环(.f函数循环) map(.x, .f)：输入两个向量 map3(.x, .f)：输入n（大于2）向量 这里边的向量是比较广的向量，包含向量，列表，字符串，数据框（可以看作向量的向量），只要有这种顺序结构的都可以作为map的输入 6.4 举个栗子 6.4.1 加载数据 library(tidyverse) library(purrr) data &lt;- mtcars head(data, 5) ## mpg cyl disp hp drat wt qsec vs am gear carb ## Mazda RX4 21.0 6 160 110 3.90 2.620 16.46 0 1 4 4 ## Mazda RX4 Wag 21.0 6 160 110 3.90 2.875 17.02 0 1 4 4 ## Datsun 710 22.8 4 108 93 3.85 2.320 18.61 1 1 4 1 ## Hornet 4 Drive 21.4 6 258 110 3.08 3.215 19.44 1 0 3 1 ## Hornet Sportabout 18.7 8 360 175 3.15 3.440 17.02 0 0 3 2 6.4.2 使用tidyverse结构和purrr来划分数据分别做回归 我们现在想根据cyl对数据框进行划分，在分出来的数据框中做回归，然后把回归结果放到一个数字向量里 data |&gt; split(data$cyl) |&gt; # 划分数据 map(\\(df) lm(mpg ~ wt, data = df)) |&gt; #分别做循环 map(summary) %&gt;% #对结果做summary map_dbl(&quot;r.squared&quot;) ## 4 6 8 ## 0.5086326 0.4645102 0.4229655 查看以下代码，发现了什么？ purrr循环的第一个参数始终是数据，因此 purrr 可以自然地与管道配合使用。 map_xxx（map的后缀相当于自定义了输出类型） 6.4.3 常规方法来做这个模型 var &lt;- c(&quot;disp&quot;, &quot;hp&quot;, &quot;drat&quot;) data_list &lt;- split(data, mtcars$cyl) vec_result = c() for (temp_data in data_list) { model = lm(mpg ~ wt, data = temp_data) model_summary = summary(model) r2 = model_summary$&quot;r.squared&quot; vec_result = c(vec_result, r2) } print(vec_result) ## [1] 0.5086326 0.4645102 0.4229655 发现了什么 代码行数多了很多 多了一些中间变量 代码可读性差，很不优雅 6.5 多变量索引循环 如果是想用多个向量来索引循环，输入多个向量，我们要怎么做呢。举一个简单的例子就知道了。 var1 &lt;- c(&quot;disp&quot;, &quot;hp&quot;, &quot;drat&quot;) var2 &lt;- c(&quot;wt&quot;, &quot;qsec&quot;, &quot;vs&quot;) var_add &lt;- map2(var1, var2, \\(x, y) paste0(x, &quot;+&quot;, y)) print(var_add) ## [[1]] ## [1] &quot;disp+wt&quot; ## ## [[2]] ## [1] &quot;hp+qsec&quot; ## ## [[3]] ## [1] &quot;drat+vs&quot; 再举个例子 means &lt;- 1:4 sds &lt;- 1:4 set.seed(2020) samples &lt;- map2(means, sds, \\(mean, sds){rnorm(mean, sds, n = 5)}) #这里也可以写为，如下，不过有时候想要更复杂的操作就不要用这种简化的写法 #samples &lt;- map2(means, sds, rnorm, n = 5) str(samples) ## List of 4 ## $ : num [1:5] 1.377 1.302 -0.098 -0.13 -1.797 ## $ : num [1:5] 3.44 3.88 1.54 5.52 2.23 ## $ : num [1:5] 0.441 5.728 6.589 1.885 2.63 ## $ : num [1:5] 11.2 10.82 -8.16 -5.16 4.23 如果输入的是多个向量可以参考如下 var3 &lt;- c(&quot;disp&quot;, &quot;hp&quot;, &quot;drat&quot;) var4 &lt;- c(&quot;wt&quot;, &quot;qsec&quot;, &quot;vs&quot;) #使用pmap的时候，把多个向量放到list框里作为第一个参数 pvar_add &lt;- pmap(list(var1, var2, var3, var4), \\(x, y, z, p) paste0(x, &quot;+&quot;, y, &quot;+&quot;, z, &quot;+&quot;, &quot;p&quot;)) print(pvar_add) ## [[1]] ## [1] &quot;disp+wt+disp+p&quot; ## ## [[2]] ## [1] &quot;hp+qsec+hp+p&quot; ## ## [[3]] ## [1] &quot;drat+vs+drat+p&quot; 注意：这里用的都是简单的字符向量，但我们使用的时候可以自由拓展到数据框和列表等复杂向量结构，就能感觉到purrr循环的魅力了 6.6 嵌套循环 如果是嵌套结构我们怎么用purrr来做呢，其实也很简单。我们现在来算一下1：10分别乘以10:20然后放到一个数字向量里怎么实现吧 map(1:10, \\(x){map(10:20, \\(y){x*y})}) |&gt; unlist() ## [1] 10 11 12 13 14 15 16 17 18 19 20 20 22 24 26 28 30 32 ## [19] 34 36 38 40 30 33 36 39 42 45 48 51 54 57 60 40 44 48 ## [37] 52 56 60 64 68 72 76 80 50 55 60 65 70 75 80 85 90 95 ## [55] 100 60 66 72 78 84 90 96 102 108 114 120 70 77 84 91 98 105 ## [73] 112 119 126 133 140 80 88 96 104 112 120 128 136 144 152 160 90 99 ## [91] 108 117 126 135 144 153 162 171 180 100 110 120 130 140 150 160 170 180 ## [109] 190 200 举得例子比较没有意义，但是可以在此基础上一窥嵌套循环的实现。 6.7 更多 purrr可以快捷实现很多高级操作，比如批量导入数据，批量绘图以及批量建模等，后续分开写吧。这一期写得很宽泛，大家可以自己去探索更多操作。 "],["r语言配色教程.html", "7 R语言配色教程 7.1 基础工作 7.2 使用RColorBrewer包设置颜色 7.3 使用ggsci包设置颜色 7.4 其它实用r包", " 7 R语言配色教程 第98期 R语言教程 科研绘图配色常用R包 在r语言，ggplot2绘图过程中最重要的一部分就是配色的选择。优秀的配色要充分考虑到颜色的区分度，期刊要求，冷暖特点等 本期介绍如何调整r语言中的配色，使整个图片美观优雅 7.1 基础工作 7.1.1 加载数据 library(bruceR) library(ggplot2) data(iris) head(iris, 10) ## Sepal.Length Sepal.Width Petal.Length Petal.Width Species ## 1 5.1 3.5 1.4 0.2 setosa ## 2 4.9 3.0 1.4 0.2 setosa ## 3 4.7 3.2 1.3 0.2 setosa ## 4 4.6 3.1 1.5 0.2 setosa ## 5 5.0 3.6 1.4 0.2 setosa ## 6 5.4 3.9 1.7 0.4 setosa ## 7 4.6 3.4 1.4 0.3 setosa ## 8 5.0 3.4 1.5 0.2 setosa ## 9 4.4 2.9 1.4 0.2 setosa ## 10 4.9 3.1 1.5 0.1 setosa 7.1.2 使用r默认配色方案 ggplot(iris, aes(x = Species, y = Sepal.Length, fill = Species)) + geom_bar(stat = &quot;identity&quot;) + labs(title = &quot;Sepal Length by Species&quot;, x = &quot;Species&quot;, y = &quot;Sepal Length&quot;) + theme_minimal() 7.1.3 ggplot2手动调色 ggplot(iris, aes(x = Species, y = Sepal.Length, fill = Species)) + geom_bar(stat = &quot;identity&quot;) + labs(title = &quot;Sepal Length by Species&quot;, x = &quot;Species&quot;, y = &quot;Sepal Length&quot;) + theme_minimal()+ scale_fill_manual(values = c(&quot;black&quot;, &quot;grey&quot;, &quot;brown&quot;)) 7.2 使用RColorBrewer包设置颜色 7.2.1 Rcolorbrew介绍 CRAN库:CRAN: Package RColorBrewer (r-project.org) 调用网站https://colorbrewer2.org/上的配色方案,使用人数众多,整体比较中规中矩 library(RColorBrewer) 7.2.2 查看配色盘，选择3颜色，区分色 先display配色,查看目标色数和色型 选择合适的调色盘,在ggplot中使用 scale_*_brewer调用 display.brewer.all(3, type = &#39;div&#39;) 7.2.3 ggplot2建立柱状图可视化 ggplot(iris, aes(x = Species, y = Sepal.Length, fill = Species)) + geom_bar(stat = &quot;identity&quot;) + labs(title = &quot;Sepal Length by Species&quot;, x = &quot;Species&quot;, y = &quot;Sepal Length&quot;) + theme_minimal()+ scale_fill_brewer(palette = &quot;Spectral&quot;) 7.3 使用ggsci包设置颜色 7.3.1 R包介绍 ggsci包含期刊或软件的经典配色,投稿时调用快,效果好,顺手就用上了我用该包配色最多 CRAN库:CRAN: Package ggsci (r-project.org) 教程:Scientific Journal and Sci-Fi Themed Color Palettes for ggplot2 (r-project.org) library(ggsci) 7.3.2 配色方案 Name Scales Palette Types Palette Generator NPG scale_color_npg() scale_fill_npg() \"nrc\" pal_npg() AAAS scale_color_aaas() scale_fill_aaas() \"default\" pal_aaas() NEJM scale_color_nejm() scale_fill_nejm() \"default\" pal_nejm() Lancet scale_color_lancet() scale_fill_lancet() \"lanonc\" pal_lancet() JAMA scale_color_jama() scale_fill_jama() \"default\" pal_jama() BMJ scale_color_bmj() scale_fill_bmj() \"default\" pal_bmj() JCO scale_color_jco() scale_fill_jco() \"default\" pal_jco() UCSCGB scale_color_ucscgb() scale_fill_ucscgb() \"default\" pal_ucscgb() D3 scale_color_d3()``scale_fill_d3() \"category10\" \"category20\" \"category20b\" \"category20c\" pal_d3() Observable scale_color_observable() scale_fill_observable() \"observable10\" pal_observable() LocusZoom scale_color_locuszoom() scale_fill_locuszoom() \"default\" pal_locuszoom() IGV scale_color_igv() scale_fill_igv() \"default\"``\"alternating\" pal_igv() COSMIC scale_color_cosmic() scale_fill_cosmic() \"hallmarks_light\"``\"hallmarks_dark\"``\"signature_substitutions\" pal_cosmic() UChicago scale_color_uchicago() scale_fill_uchicago() \"default\"``\"light\"``\"dark\" pal_uchicago() Star Trek scale_color_startrek() scale_fill_startrek() \"uniform\" pal_startrek() Tron Legacy scale_color_tron() scale_fill_tron() \"legacy\" pal_tron() Futurama scale_color_futurama() scale_fill_futurama() \"planetexpress\" pal_futurama() Rick and Morty scale_color_rickandmorty() scale_fill_rickandmorty() \"schwifty\" pal_rickandmorty() The Simpsons scale_color_simpsons() scale_fill_simpsons() \"springfield\" pal_simpsons() Flat UI scale_color_flatui() scale_fill_flatui() \"default\" \"flattastic\" \"aussie\" pal_flatui() Frontiers scale_color_frontiers() scale_fill_frontiers() \"default\" pal_frontiers() GSEA scale_color_gsea() scale_fill_gsea() \"default\" pal_gsea() Bootstrap 5 scale_color_bs5() scale_fill_bs5() \"blue\" \"indigo\"``\"purple\" \"pink\"``\"red\" \"orange\"``\"yellow\" \"green\"``\"teal\" \"cyan\"``\"gray\" pal_bs5() Material Design scale_color_material() scale_fill_material() \"red\" \"pink\"``\"purple\" \"deep-purple\"``\"indigo\" \"blue\"``\"light-blue\" \"cyan\"``\"teal\" \"green\"``\"light-green\" \"lime\"``\"yellow\" \"amber\"``\"orange\" \"deep-orange\"``\"brown\" \"grey\"``\"blue-grey\" pal_material() Tailwind CSS scale_color_tw3() scale_fill_tw3() \"slate\" \"gray\"``\"zinc\" \"neutral\"``\"stone\" \"red\"``\"orange\" \"amber\"``\"yellow\" \"lime\"``\"green\" \"emerald\"``\"teal\" \"cyan\"``\"sky\" \"blue\"``\"indigo\" \"violet\"``\"purple\" \"fuchsia\"``\"pink\" \"rose\" pal_tw3() 7.3.3 柳叶刀配色 ggplot(iris, aes(x = Species, y = Sepal.Length, fill = Species)) + geom_bar(stat = &quot;identity&quot;) + labs(title = &quot;Sepal Length by Species&quot;, x = &quot;Species&quot;, y = &quot;Sepal Length&quot;) + theme_minimal()+ scale_fill_lancet() 7.4 其它实用r包 7.4.1 viridis: Colorblind-Friendly Color Maps for R 7.4.1.1 介绍 官方仓库:CRAN: Package viridis (r-project.org) 教程:Introduction to the viridis color maps (r-project.org) 多用于连续渐变色 7.4.1.2 使用效果 色盘 使用方案参考 7.4.2 使用MetBrewer包设置颜色 7.4.2.1 r包介绍 官方CRAN库:CRAN: Package MetBrewer (r-project.org) 配色方案参考纽约大都会艺术博物馆,艺术感爆表一起来看看 library(MetBrewer) 7.4.2.2 查看配色盘，选择3颜色，区分色 ggplot(iris, aes(x = Species, y = Sepal.Length, fill = Species)) + geom_bar(stat = &quot;identity&quot;) + labs(title = &quot;Sepal Length by Species&quot;, x = &quot;Species&quot;, y = &quot;Sepal Length&quot;) + theme_minimal()+ scale_fill_manual(values = met.brewer(&quot;Austria&quot;)) ggplot(iris, aes(x = Species, y = Sepal.Length, fill = Species)) + geom_bar(stat = &quot;identity&quot;) + labs(title = &quot;Sepal Length by Species&quot;, x = &quot;Species&quot;, y = &quot;Sepal Length&quot;) + theme_minimal()+ scale_fill_manual(values = met.brewer(&quot;Degas&quot;)) 最后看看好看 "],["patchwork拒绝psr内实现多图拼接.html", "8 patchwork：拒绝ps，R内实现多图拼接 8.1 R包介绍 8.2 R包安装 8.3 R包使用 8.4 添加图注 8.5 图表拼接", " 8 patchwork：拒绝ps，R内实现多图拼接 8.1 R包介绍 Patchwork 是一个软件包，旨在使 R 中的绘图合成变得极其简单和强大。它主要面向 ggplot2 的用户，无论绘图的复杂程度如何，它都能不遗余力地确保 ggplots 正确对齐。 注意：仅用于ggplot2的绘图，R的base绘图不能用patchwork拼接 链接:CRAN链接 学习手册:学习手册 8.2 R包安装 install.packages(&quot;patchwork&quot;) 8.3 R包使用 8.3.1 先生成多图准备着 library(ggplot2) library(patchwork) p1 &lt;- ggplot(mtcars) + geom_point(aes(mpg, disp)) + ggtitle(&#39;Plot 1&#39;) p2 &lt;- ggplot(mtcars) + geom_boxplot(aes(gear, disp, group = gear)) + ggtitle(&#39;Plot 2&#39;) p3 &lt;- ggplot(mtcars) + geom_point(aes(hp, wt, colour = mpg)) + ggtitle(&#39;Plot 3&#39;) p4 &lt;- ggplot(mtcars) + geom_bar(aes(gear)) + facet_wrap(~cyl) + ggtitle(&#39;Plot 4&#39;) 8.3.2 基础用法 patchwork的基础用法就是使用数学符号(+和/)来实现图形的横纵拼接 8.3.3 多图横拼接 p1 + p2 默认patchwork会让图形呈方形排列，即nxn p1 + p2 + p3 + p4 8.3.4 多图纵拼接 p1/p2 8.3.5 复合图拼接 这里图形拼接类似于数学符号的表达式，同样遵循先乘除后加减的规律,有括号先括号 p1 + p2 / p3 + p4 (p1 + p2)/(p3 + p4 ) 8.4 添加图注 patchwork提供了plot_annotation函数来实现图注的添加 8.4.1 小图的图注 自定义tag_levels参数，可能的值有：“a”表示小写字母，“A”表示大写字母，“1”表示数字，“i”表示小写罗马数字，“I”表示大写罗马数字。它也可以是一个包含定义任意标记序列的字符向量的列表 p1 + p2 + p3 + p4 + plot_annotation(tag_levels = &#39;A&#39;) 8.4.2 拼图整体图注 (p1 | (p2 / p3)) + plot_annotation(title = &#39;The surprising story about mtcars&#39;) 8.5 图表拼接 8.5.1 基本操作 patchwork还支持将表格和图表拼接起来，需要注意的是，表格和图表的拼接需要使用gt包 #install.packages(&quot;gt&quot;) library(gt) library(ggplot2) library(patchwork) p1 &lt;- ggplot(airquality) + geom_line(aes(x = Day, y = Temp, colour = month.name[Month])) + labs(colour = &quot;Month&quot;) aq &lt;- airquality[sample(nrow(airquality), 10), ] p1 + gt(aq) + ggtitle(&quot;Sample of the dataset&quot;) 8.5.2 参数调整 wrap_table() 可以控制其中的一些行为。首先，我们可以减小表格中的字体大小，使其变小，但也可以为其留出更多空间。我们可以使用 plot_layout(widths = …)来做到这一点，但这需要我们进行大量的猜测才能做到恰到好处。值得庆幸的是，patchwork 足够聪明，可以帮我们解决这个问题，我们可以使用 wrap_table() 中的 space 参数指示它这样做。将空间参数设置为 “free_y”后，patchwork 就会将宽度固定为表格宽度，但保持高度自由： p1 + wrap_table(gt(aq), space = &quot;free_y&quot;) + ggtitle(&quot;Sample of the dataset&quot;) p1 + wrap_table(aq, space = &quot;fixed&quot;) 如果空间固定在 Y 方向，而表格中有任何来源注释或脚注，则这些注释或脚注会像列头一样，根据面板设置放置在面板区域之外。 aq_footer &lt;- gt(aq) |&gt; tab_source_note(&quot;This is not part of the table body&quot;) p1 + wrap_table(aq_footer, space = &quot;fixed&quot;) 8.5.3 其它 图表拼接是patchwork的最新功能，详细的教程参见链接 "],["r语言图例修改自定义教程.html", "9 R语言图例修改自定义教程 9.1 图例样式修改介绍 9.2 本期主要内容来源 9.3 加载包 9.4 图例行为", " 9 R语言图例修改自定义教程 9.1 图例样式修改介绍 ggplot2中的图例样式修改（图例间距，位置修改等）一直是大部分用户的心头痛，因为它的修改方法实在太多了，而且很难记住。多种参数方法看起来杂乱无章，但是在24年2月更新的ggplot2 2.3.5之后，ggplot2的图例修改方法终于有了一个统一的标准。接下来我们一起学习一下吧 在ggplot2更新后有且仅有一种方式修改图例样式，那就是使用theme()参数 。theme()函数有新的参数来控制图例的外观，这使得全局控制图例的外观变得更容易。例如： theme(legend.frame)替换 guide_colourbar(frame.colour, frame.linewidth, frame.linetype) 和 theme(legend.axis.line)替换 guide_bins(axis, axis.colour, axis.linewidth, axis.arrow) 。（如果有其它方法就是还没弃置，建议不要用了） 9.2 本期主要内容来源 更新说明 guide_legend教程 9.3 加载包 library(ggplot2) 9.4 图例行为 9.4.1 guide_legend系列 ggplot2 中的图例包含名为guide_legend()，还包括guide_colourbar() 、 guide_coloursteps()和guide_bins()基本参数都一致，设置图例的类型 。 guide_legend( title = waiver(), theme = NULL, position = NULL, direction = NULL, override.aes = list(), nrow = NULL, ncol = NULL, reverse = FALSE, order = 0, ... ) 9.4.2 更新后加了什么 下方代码展示了如何设置某单独映射的图例样式和全局样式的区别。如果要单独设置某映射的图例样式，只需将其添加到guides() 。如果要设置全局样式，只需将其添加到theme() 。最终的参数形式就是theme(legend.XXX = element_XXX()) 。 ggplot(mpg, aes(displ, hwy, shape = factor(cyl), colour = cty)) + geom_point() + # 设置单独映射的图例 guides( shape = guide_legend(theme = theme(legend.text = element_text(colour = &quot;red&quot;))), colour = guide_colorbar(theme = theme(legend.frame = element_rect(colour = &quot;red&quot;))) ) + # 设置全局图例的样式 theme( legend.title.position = &quot;left&quot;, # Title justification is controlled by hjust/vjust in the element legend.title = element_text(angle = 90, hjust = 0.5) ) 9.4.3 图例是否显示 唯一不放在theme里的参数就是legend.show 。您可以在图层中设置show.legend = TRUE选项。和以前一样， show.legend参数仍然可以以特定于美学的方式设置。将其设置为TRUE表示“始终显示”， FALSE表示“从不显示”， NA表示“如果找到则显示”。查看下方示例，在设置了plot的showlegend里在图例中强制显示了点和线。 p &lt;- ggplot(mpg, aes(displ, hwy)) + scale_alpha_manual(values = c(0.5, 1)) p + geom_point(aes(colour = &quot;points&quot;, alpha = &quot;points&quot;)) + geom_line( aes(colour = &quot;line&quot;, alpha = &quot;line&quot;), stat = &quot;smooth&quot;, formula = y ~ x, method = &quot;lm&quot; ) p + geom_point( aes(colour = &quot;points&quot;, alpha = &quot;points&quot;), show.legend = TRUE # always show ) + geom_line( aes(colour = &quot;line&quot;, alpha = &quot;line&quot;), stat = &quot;smooth&quot;, formula = y ~ x, method = &quot;lm&quot;, show.legend = c(colour = NA, alpha = TRUE) # always show in alpha ) 9.4.4 图例位置 图例位置不再仅限于图的一侧。通过设置guides的position参数，你可以定制哪些参考线出现在绘图中的位置。没有设置位置的参考线（例如下面的“drv”形状图例）遵循全局主题的legend.position设置。 p &lt;- ggplot(mpg, aes(displ, hwy, shape = drv, colour = cty, size = year)) + geom_point(aes(alpha = cyl))+ theme(legend.position = &quot;left&quot;) + guides( colour = guide_colourbar(position = &quot;right&quot;), size = guide_legend(position = &quot;top&quot;), alpha = guide_legend(position = &quot;inside&quot;) ) p 9.4.4.1 图例的对齐 图例的对齐可以通过使用theme的legend.justification.{position}参数来控制。此外，通过设置legend.location参数，可以将顶部和底部参考线与绘图而不是面板对齐。默认情况下，当plot.title.position = \"plot\"时，左侧图例已经对齐。因此，对于legend.location设置，顶部和底部参考线优先。 p + labs(title = &quot;Plot-aligned title&quot;) + theme( legend.margin = margin(0, 0, 0, 0), # turned off for alignment legend.justification.top = &quot;left&quot;, legend.justification.left = &quot;top&quot;, legend.justification.bottom = &quot;right&quot;, legend.justification.inside = c(1, 1), legend.location = &quot;plot&quot;, plot.title.position = &quot;plot&quot; ) 9.4.5 图例的间距 我们先观看一下下方的图，表示图例的组成和间距的含义 图例图示 当标题和键没有明确的边距时，会根据文本或标题位置自动添加适当的边距。但是，如果您覆盖边距，它们将按你的设置来走。 ggplot(mpg, aes(displ, hwy, colour = class)) + geom_point() + guides(colour = guide_legend(ncol = 2)) + theme( legend.key.spacing.x = unit(10, &quot;pt&quot;), legend.key.spacing.y = unit(20, &quot;pt&quot;), legend.text = element_text(margin = margin(l = 0)), legend.title = element_text(margin = margin(b = 20)) ) 9.4.6 添加特殊图例 guide_custom() 。它可用于将任何图形对象（grob）添加到绘图中，例如annotation_custom() 。但有一些区别：它的位置就像图例一样，并添加了标题和页边距。从某种意义上说，本图例是“特殊的”，因为它是唯一不直接反映比例的指南。缺点是它无法从图中读取属性，但优点是它非常灵活。 x &lt;- c(0.5, 1, 1.5, 1.2, 1.5, 1, 0.5, 0.8, 1, 1.15, 2, 1.15, 1, 0.85, 0, 0.85) y &lt;- c(1.5, 1.2, 1.5, 1, 0.5, 0.8, 0.5, 1, 2, 1.15, 1, 0.85, 0, 0.85, 1, 1.15) compass_rose &lt;- grid::polygonGrob( x = unit(x, &quot;cm&quot;), y = unit(y, &quot;cm&quot;), id.lengths = c(8, 8), gp = grid::gpar(fill = c(&quot;grey50&quot;, &quot;grey25&quot;), col = NA) ) nc &lt;- sf::st_read(system.file(&quot;shape/nc.shp&quot;, package = &quot;sf&quot;), quiet = TRUE) ggplot(nc) + geom_sf(aes(fill = AREA)) + guides(custom = guide_custom(compass_rose, title = &quot;compass&quot;)) "],["r语言绘制桑基图详细教程.html", "10 R语言绘制桑基图详细教程 10.1 R包介绍 10.2 R包安装 10.3 R包使用 10.4 总绘图代码 10.5 绘图代码拆解", " 10 R语言绘制桑基图详细教程 本期主要介绍常用桑基图（流量图）绘制包ggsankeyfier和相关代码教程 桑基图也叫流量图，主要用来处理多个分类变量的分布情况。可视化展示占比比例等，美观容易 10.1 R包介绍 CRAN库 教程手册 10.2 R包安装 install.packages(&quot;ggsankeyfier&quot;) 10.3 R包使用 桑基图本质上就是不同分类变量的流量图，可视化的第一步就是数据整洁化，常用数据宽变长。一列是变量，一列是流量值，在ggsankeyfier使用过程中重要的就是用pivot_stages_longer来做数据清洗 10.3.1 数据准备 library(ggsankeyfier) library(tidyverse) library(cowplot) ## first get a data set with a wide format: data(ecosystem_services) data &lt;- ecosystem_services ## pivot to long format for plotting: data_neat &lt;- data |&gt; subset(RCSES &gt; 0.005) |&gt; pivot_stages_longer( c(&quot;activity_realm&quot;, &quot;biotic_realm&quot;, &quot;service_section&quot;), &quot;RCSES&quot;, &quot;service_section&quot; ) # pivot宽变长前 head(data, 5) ## # A tibble: 5 × 8 ## activity_type activity_realm pressure_cat biotic_group biotic_realm ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 Agriculture &amp; Forestry Land-based Biological di… Zooplankton Plankton ## 2 Agriculture &amp; Forestry Land-based Biological di… Zooplankton Plankton ## 3 Agriculture &amp; Forestry Land-based Chemical chan… Zooplankton Plankton ## 4 Agriculture &amp; Forestry Land-based Chemical chan… Zooplankton Plankton ## 5 Agriculture &amp; Forestry Land-based Physical chan… Zooplankton Plankton ## # ℹ 3 more variables: service_division &lt;chr&gt;, service_section &lt;chr&gt;, ## # RCSES &lt;dbl&gt; # 宽变长后 head(data_neat, 5) ## # A tibble: 5 × 6 ## service_section RCSES edge_id connector node stage ## &lt;fct&gt; &lt;dbl&gt; &lt;int&gt; &lt;chr&gt; &lt;fct&gt; &lt;fct&gt; ## 1 Provisioning 0.0123 1 from Land-based activity_realm ## 2 Provisioning 0.0123 1 to Plant biotic_realm ## 3 Provisioning 0.0133 2 from Land-based activity_realm ## 4 Provisioning 0.0133 2 to Fish &amp; Cephalopods biotic_realm ## 5 Cultural 0.0127 3 from Land-based activity_realm 10.4 总绘图代码 data_neat |&gt; ggplot( mapping = aes( x = stage, y = RCSES, group = node, edge_id = edge_id, connector = connector ) ) + geom_sankeyedge(aes(alpha = RCSES, fill = service_section), position = position_sankey( order = &quot;ascending&quot;, v_space = &quot;auto&quot;, width = 0.01 ) ) + geom_sankeynode(aes(fill = node, color = &quot;grey&quot;), position = position_sankey( order = &quot;ascending&quot;, v_space = &quot;auto&quot;, width = 0.11 ), show.legend = FALSE ) + geom_text( data = data_neat, aes(label = node), stat = &quot;sankeynode&quot;, position = position_sankey(v_space = &quot;auto&quot;, order = &quot;ascending&quot;, nudge_x = 0), hjust = 0.5, size = 3.5, fontface = &quot;bold&quot;, color = &quot;black&quot; )+ guides( alpha = FALSE, colour = FALSE, fill = guide_legend(position = &quot;bottom&quot;, nrow = 1) ) + scale_fill_discrete( breaks = unique(data_neat$service_section)[1:3] # 只在图例中显示前三个键 )+ theme_minimal_hgrid() + theme( # 去除周围外边距 panel.spacing = unit(0, &quot;cm&quot;), panel.grid.major.y = element_blank(), axis.text.y = element_blank(), axis.title = element_blank(), legend.key.spacing.x = unit(60, &quot;pt&quot;) ) 10.5 绘图代码拆解 接下来我们拆解上边一大段代码，一步步的跑出来就会感觉会好很多。数据的预先准备至关重要，看数据准备部分的代码就行了 10.5.1 第一步我们先把sankeyedge做出来，就是中间的流量 看到我们设置了一个至关重要的的参数position：这个参数决定了sankeyedge的位置，我们设置为position_sankey(order =\"ascending\",v_space=\"auto\",width = 0.01)，其中order是设置sankeyedge的方向，ascending是从左到右，descending是从右到左，v_space是设置sankeyedge的间距，auto是自动设置，width是设置sankeyedge的宽度。 data_neat |&gt; ggplot( mapping = aes( x = stage, y = RCSES, group = node, edge_id = edge_id, connector = connector, fill = stage ) ) + geom_sankeyedge(aes(alpha = RCSES, fill = service_section), position = position_sankey( order = &quot;ascending&quot;, v_space = &quot;auto&quot;, width = 0.01 ) ) 10.5.2 很好，下一部我们把node给加上，就是各个小方块 设置node的填充色是node，然后边框设置成灰色 data_neat |&gt; ggplot( mapping = aes( x = stage, y = RCSES, group = node, edge_id = edge_id, connector = connector ) ) + geom_sankeyedge(aes(alpha = RCSES, fill = service_section), position = position_sankey( order = &quot;ascending&quot;, v_space = &quot;auto&quot;, width = 0.01 ) ) + geom_sankeynode(aes(fill = node, color = &quot;grey&quot;), position = position_sankey( order = &quot;ascending&quot;, v_space = &quot;auto&quot;, width = 0.1 ) ) 10.5.3 然后我们添加文字到图形里 注意添加 stat = \"sankeynode\" data_neat |&gt; ggplot( mapping = aes( x = stage, y = RCSES, group = node, edge_id = edge_id, connector = connector ) ) + geom_sankeyedge(aes(alpha = RCSES, fill = service_section), position = position_sankey( order = &quot;ascending&quot;, v_space = &quot;auto&quot;, width = 0.01 ) ) + geom_sankeynode(aes(fill = node, color = &quot;grey&quot;), position = position_sankey( order = &quot;ascending&quot;, v_space = &quot;auto&quot;, width = 0.1 ) ) + geom_text( data = data_neat, aes(label = node), stat = &quot;sankeynode&quot;, position = position_sankey(v_space = &quot;auto&quot;, order = &quot;ascending&quot;, nudge_x = 0), hjust = 0.5, size = 3.5, fontface = &quot;bold&quot;, color = &quot;black&quot; ) 10.5.4 最后阶段我们修改一下图例，改改主题 我们的主要变量是service_section（geom_sankeyedge的fill映射），我们在这里就设置这个作为图例，其它都删掉。这一部分说起来简单，其实挺麻烦的。 data_neat |&gt; ggplot( mapping = aes( x = stage, y = RCSES, group = node, edge_id = edge_id, connector = connector ) ) + geom_sankeyedge(aes(alpha = RCSES, fill = service_section), position = position_sankey( order = &quot;ascending&quot;, v_space = &quot;auto&quot;, width = 0.01 ) ) + geom_sankeynode(aes(fill = node, color = &quot;grey&quot;), position = position_sankey( order = &quot;ascending&quot;, v_space = &quot;auto&quot;, width = 0.11 ), show.legend = FALSE ) + geom_text( data = data_neat, aes(label = node), stat = &quot;sankeynode&quot;, position = position_sankey(v_space = &quot;auto&quot;, order = &quot;ascending&quot;, nudge_x = 0), hjust = 0.5, size = 3.5, fontface = &quot;bold&quot;, color = &quot;black&quot; )+ guides( alpha = FALSE, colour = FALSE, fill = guide_legend(position = &quot;bottom&quot;, nrow = 1) ) + scale_fill_discrete( breaks = unique(data_neat$service_section)[1:3] # 只在图例中显示前三个键 )+ theme_minimal_hgrid() + theme( # 去除周围外边距 panel.spacing = unit(0, &quot;cm&quot;), panel.grid.major.y = element_blank(), axis.text.y = element_blank(), axis.title = element_blank(), legend.key.spacing.x = unit(60, &quot;pt&quot;) ) "],["r语言采样地图绘制详细教程.html", "11 R语言采样地图绘制详细教程 11.1 R包介绍 11.2 R包安装 11.3 基础绘图代码 11.4 我们来自定义绘图内容", " 11 R语言采样地图绘制详细教程 本期主要介绍如何绘制采样地图和国内区域地图，并自定义相关内容 11.1 R包介绍 ggspatial教程 11.2 R包安装 install.packages(&quot;ggspatial&quot;) install.packages(&quot;sf&quot;) 11.3 基础绘图代码 11.3.1 导入地图json数据 进入从阿里云DataV可视化网站（可选择其他平台）下载格式为.json的地图数据： 11.3.2 数据导入 library(ggspatial) library(sf) ## Linking to GEOS 3.11.2, GDAL 3.8.2, PROJ 9.3.1; sf_use_s2() is TRUE library(ggplot2) # 导入地图json数据 map &lt;- st_read(&quot;01-attch\\\\10\\\\广州市.json&quot;) ## Reading layer `广州市&#39; from data source ## `D:\\0 zotero笔记\\06-其它\\3 公众号\\1 blogpost-r\\01-attch\\10\\广州市.json&#39; ## using driver `GeoJSON&#39; ## Simple feature collection with 11 features and 9 fields ## Geometry type: MULTIPOLYGON ## Dimension: XY ## Bounding box: xmin: 112.9585 ymin: 22.51436 xmax: 114.06 ymax: 23.93292 ## Geodetic CRS: WGS 84 11.3.3 开始绘制 11.3.3.1 添加省份区边框 ggplot() + labs(title = &quot;Guangzhou&quot;, x = NULL, y = NULL) + geom_sf(data = map, fill = c(&quot;#f0eedf&quot;), size = 0.8, color = &quot;black&quot;) 11.3.3.2 添加指南针annotation p &lt;- ggplot() + labs(title = &quot;Guangzhou&quot;, x = NULL, y = NULL) + geom_sf(data = map, fill = c(&quot;#f0eedf&quot;), size = 0.8, color = &quot;black&quot;) + # 设置比例尺 annotation_north_arrow( location = &quot;tl&quot;, style = north_arrow_nautical( fill = c(&quot;black&quot;, &quot;white&quot;), line_col = &quot;black&quot; ) ) p 11.4 我们来自定义绘图内容 11.4.1 设置白云区天河区突出显示 我们新加一个图层就可以，然后fill填充亮色 p + geom_sf( data = map |&gt; dplyr::filter(name %in% c(&quot;天河区&quot;, &quot;白云区&quot;, &quot;番禺区&quot;)), fill = c(&quot;#c98c50&quot;), size = 0.8, color = &quot;black&quot; ) 11.4.2 设置text 接下来我们要在图里标注部分区名 library(showtext) showtext::showtext_auto() p + geom_sf( data = map |&gt; dplyr::filter(name %in% c(&quot;天河区&quot;, &quot;白云区&quot;, &quot;番禺区&quot;)), fill = c(&quot;#c98c50&quot;), size = 0.8, color = &quot;black&quot; ) + geom_sf_text( data = map |&gt; dplyr::filter(name %in% c(&quot;天河区&quot;, &quot;白云区&quot;, &quot;番禺区&quot;)), aes(label = name), size = 3, color = &quot;black&quot;, fontface = &quot;bold&quot; ) 11.4.3 设置一个合适的主题 p2 &lt;- p + geom_sf( data = map |&gt; dplyr::filter(name %in% c(&quot;天河区&quot;, &quot;白云区&quot;, &quot;番禺区&quot;)), fill = c(&quot;#c98c50&quot;), size = 0.8, color = &quot;black&quot; ) + geom_sf_text( data = map |&gt; dplyr::filter(name %in% c(&quot;天河区&quot;, &quot;白云区&quot;, &quot;番禺区&quot;)), aes(label = name), size = 3, color = &quot;black&quot;, fontface = &quot;bold&quot; ) + theme_minimal() p2 11.4.4 设置根据数值变量对各区的fill进行映射 # 先生成一个随机变量 map_neat_1 &lt;- map |&gt; dplyr::mutate( value = sample(1:100, nrow(map), replace = TRUE) ) ggplot() + labs(title = &quot;map_neat_1&quot;, x = NULL, y = NULL) + geom_sf(data = map_neat_1, aes(fill = value), size = 0.8, color = &quot;black&quot;) + # 设置比例尺 annotation_north_arrow( location = &quot;tl&quot;, style = north_arrow_nautical( fill = c(&quot;black&quot;, &quot;white&quot;), line_col = &quot;black&quot; ) ) + geom_sf_text( data = map, aes(label = name), size = 3, color = &quot;black&quot;, fontface = &quot;bold&quot; ) + theme_minimal() 11.4.5 根据分类变量对区进行fill映射 library(MetBrewer) map_neat_2 &lt;- map |&gt; dplyr::mutate( group = sample(c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;), nrow(map), replace = TRUE) ) ggplot() + labs(title = &quot;map_neat_2&quot;, x = NULL, y = NULL) + geom_sf(data = map_neat_2, aes(fill = group), size = 0.8, color = &quot;black&quot;) + # 设置比例尺 annotation_north_arrow( location = &quot;tl&quot;, style = north_arrow_nautical( fill = c(&quot;black&quot;, &quot;white&quot;), line_col = &quot;black&quot; ) ) + geom_sf_text( data = map, aes(label = name), size = 3, color = &quot;black&quot;, fontface = &quot;bold&quot; ) + theme_minimal() + scale_fill_met_d(&quot;Cassatt1&quot;) 11.4.6 添加采样点 data_sample &lt;- tibble::tibble( lon = c(113.292333, 113.412333, 113.532333), lat = c(23.191944, 23.331944, 22.931944), point = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;), ) p2 + geom_point( data = data_sample, aes(x = lon, y = lat), size = 2, color = &quot;#1647a3&quot; ) + geom_text( data = data_sample, aes(x = lon, y = lat, label = point), size = 4, color = &quot;#000000&quot;, fontface = &quot;bold&quot;, nudge_y = 0.05 )+ labs(title = &quot;广州市&quot;)+ theme(plot.title = element_text(hjust = 0.5)) "],["r语言绘制森林图详细教程-forestplot.html", "12 R语言绘制森林图详细教程-forestplot 12.1 R包介绍 12.2 R包安装 12.3 R包教程 12.4 样式美化", " 12 R语言绘制森林图详细教程-forestplot 本期主要介绍如何使用forestplot包绘制森林图，常用于meta分析的可视化/ 根据我的教程书写体验来看forestplot包还很不好用，基于gpar包来设置样式，使用体验极不好，不过写都写了，发一点东西 根据实际体验来看还是forestploter包绘制森林图更好看，代码更合理，样式也更好看，之后会介绍 这期不建议看，这个包也不建议用，连教程文档很多都跑不动 12.1 R包介绍 forestplot包是R语言中用于绘制森林图的包，其主要功能是将数据整理成适合绘制森林图的格式，并提供了丰富的绘图选项，使得用户可以轻松地绘制出各种类型的森林图。 更多教程 12.2 R包安装 install.packages(&quot;forestplot&quot;) 12.3 R包教程 12.3.1 载入包 library(forestplot) library(dplyr) 12.3.2 导入数据 mean: OR区间的平均值 lower/upper：置信区间上下限 study：标签 data &lt;- tibble::tibble( mean = c(0.578, 0.165, 0.246, 0.700, 0.348, 0.139, 1.017), lower = c(0.372, 0.018, 0.072, 0.333, 0.083, 0.016, 0.365), upper = c(0.898, 1.517, 0.833, 1.474, 1.455, 1.209, 2.831), study = c( &quot;Auckland&quot;, &quot;Block&quot;, &quot;Doran&quot;, &quot;Gamsu&quot;, &quot;Morrison&quot;, &quot;Papageorgiou&quot;, &quot;Tauesch&quot; ), deaths_steroid = c(&quot;36&quot;, &quot;1&quot;, &quot;4&quot;, &quot;14&quot;, &quot;3&quot;, &quot;1&quot;, &quot;8&quot;), deaths_placebo = c(&quot;60&quot;, &quot;5&quot;, &quot;11&quot;, &quot;20&quot;, &quot;7&quot;, &quot;7&quot;, &quot;10&quot;), OR = c(&quot;0.58&quot;, &quot;0.16&quot;, &quot;0.25&quot;, &quot;0.70&quot;, &quot;0.35&quot;, &quot;0.14&quot;, &quot;1.02&quot;) ) 12.3.3 基础绘图 可以看出forestplot包绘制森林图主体为forestplot函数，后续增加fp_xxx函数来完善内容 fp_set_style：设置样式 fp_add_header：添加表头 fp_append_row：额外添加行 data |&gt; forestplot( labeltext = c(study, deaths_steroid, deaths_placebo, OR), clip = c(0.1, 2.5), xlog = TRUE ) |&gt; fp_set_style( box = &quot;royalblue&quot;, line = &quot;darkblue&quot;, summary = &quot;royalblue&quot; ) |&gt; fp_add_header( study = c(&quot;&quot;, &quot;Study&quot;), deaths_steroid = c(&quot;Deaths&quot;, &quot;(steroid)&quot;), deaths_placebo = c(&quot;Deaths&quot;, &quot;(placebo)&quot;), OR = c(&quot;&quot;, &quot;OR&quot;) ) |&gt; fp_append_row( mean = 0.531, lower = 0.386, upper = 0.731, study = &quot;Summary&quot;, OR = &quot;0.53&quot;, is.summary = TRUE ) |&gt; fp_set_zebra_style(&quot;#EFEFEF&quot;) 12.4 样式美化 12.4.1 修改样式 使用fp_set_style来修改各内容的样式 使用fp_add_lines来添加线条 更多参数大家需要多看help文档 主要参考的是设置是gpar包样式 data |&gt; forestplot( labeltext = c(study, deaths_steroid, deaths_placebo, OR), clip = c(0.1, 2.5), xlog = TRUE ) |&gt; fp_add_lines() |&gt; fp_set_style( box = &quot;royalblue&quot;, line = &quot;darkblue&quot;, summary = &quot;royalblue&quot;, align = &quot;lrrr&quot;, hrz_lines = &quot;#999999&quot; ) |&gt; fp_add_header( study = c(&quot;&quot;, &quot;Study&quot;), deaths_steroid = c(&quot;Deaths&quot;, &quot;(steroid)&quot;) |&gt; fp_align_center(), deaths_placebo = c(&quot;Deaths&quot;, &quot;(placebo)&quot;) |&gt; fp_align_center(), OR = c(&quot;&quot;, fp_align_center(&quot;OR&quot;)) ) |&gt; fp_append_row( mean = 0.531, lower = 0.386, upper = 0.731, study = &quot;Summary&quot;, OR = &quot;0.53&quot;, is.summary = TRUE ) 12.4.2 对线条自定义 使用fp_add_lines来添加辅助线，lty是线形，lwd是线宽，col是颜色 f_n代表对第几列添加线条，columns设置线条有多宽 data |&gt; forestplot( labeltext = c(study, deaths_steroid, deaths_placebo, OR), clip = c(0.1, 2.5), vertices = TRUE, xlog = TRUE ) |&gt; fp_add_lines( h_3 = gpar(lty = 2), h_11 = gpar(lwd = 1, columns = 1:4, col = &quot;#000044&quot;) ) |&gt; fp_set_style( box = &quot;royalblue&quot;, line = &quot;darkblue&quot;, summary = &quot;royalblue&quot;, align = &quot;lrrr&quot;, hrz_lines = &quot;#999999&quot; ) |&gt; fp_add_header( study = c(&quot;&quot;, &quot;Study&quot;), deaths_steroid = c(&quot;Deaths&quot;, &quot;(steroid)&quot;) |&gt; fp_align_center(), deaths_placebo = c(&quot;Deaths&quot;, &quot;(placebo)&quot;) |&gt; fp_align_center(), OR = c(&quot;&quot;, fp_align_center(&quot;OR&quot;)) ) |&gt; fp_append_row( mean = 0.531, lower = 0.386, upper = 0.731, study = &quot;Summary&quot;, OR = &quot;0.53&quot;, is.summary = TRUE ) 12.4.3 减小固定box（就是平均值的那个盒子）大小 强制boxsize的大小，使用函数forestplot的参数boxsize,但是设置之后大小也不会随着OR增大而增大 data |&gt; forestplot( labeltext = c(study, deaths_steroid, deaths_placebo, OR), clip = c(0.1, 2.5), vertices = TRUE, boxsize = 0.2, xlog = TRUE ) |&gt; fp_add_lines( h_3 = gpar(lty = 2), h_11 = gpar(lwd = 1, columns = 1:4, col = &quot;#000044&quot;) ) |&gt; fp_set_style( box = &quot;royalblue&quot;, line = &quot;darkblue&quot;, summary = &quot;royalblue&quot;, align = &quot;lrrr&quot;, hrz_lines = &quot;#999999&quot; ) |&gt; fp_add_header( study = c(&quot;&quot;, &quot;Study&quot;), deaths_steroid = c(&quot;Deaths&quot;, &quot;(steroid)&quot;) |&gt; fp_align_center(), deaths_placebo = c(&quot;Deaths&quot;, &quot;(placebo)&quot;) |&gt; fp_align_center(), OR = c(&quot;&quot;, fp_align_center(&quot;OR&quot;)) ) |&gt; fp_append_row( mean = 0.531, lower = 0.386, upper = 0.731, study = &quot;Summary&quot;, OR = &quot;0.53&quot;, is.summary = TRUE ) 12.4.4 分组OR 垃圾包，已经跑不了分组了，应该是groupby更新后没适配上。浪费我一个小时 data(dfHRQoL) dfHRQoL |&gt; group_by(group)|&gt; forestplot( labeltext = c(labeltext), boxsize = 0.1, lineheight = &quot;lines&quot;, xlab = &quot;EQ-5D index&quot; ) |&gt; fp_add_lines(&quot;steelblue&quot;) |&gt; fp_add_header(&quot;Variable&quot;) |&gt; fp_set_style( box = c(&quot;blue&quot;, &quot;darkred&quot;) |&gt; lapply(function(x) gpar(fill = x, col = &quot;#555555&quot;)), default = gpar(vertices = TRUE) ) "],["r语言批量导入数据.html", "13 R语言批量导入数据 13.1 批量导入文件夹下的所有数据文件 13.2 批量导入excel下的多个sheet 13.3 尾语", " 13 R语言批量导入数据 13.1 批量导入文件夹下的所有数据文件 以公开数据库CHRALS为例 在文件夹下有10个dta文件，文件名各不一致。如何将所有文件导入一个列表中？ 13.1.1 载入包 library(bruceR) library(purrr) rm(list = ls()) 13.1.2 第一步:提取文件名 files &lt;- fs::dir_ls(&quot;D:\\\\0 zotero笔记\\\\06-其它\\\\3 公众号\\\\1 blogpost-r\\\\01-attch\\\\10\\\\CHARLS&quot;, recurse = TRUE, glob = &quot;*.dta&quot;) print(files) ## D:/0 zotero笔记/06-其它/3 公众号/1 blogpost-r/01-attch/10/CHARLS/COVID_Module.dta ## D:/0 zotero笔记/06-其它/3 公众号/1 blogpost-r/01-attch/10/CHARLS/Demographic_Background.dta ## D:/0 zotero笔记/06-其它/3 公众号/1 blogpost-r/01-attch/10/CHARLS/Exit_Module.dta ## D:/0 zotero笔记/06-其它/3 公众号/1 blogpost-r/01-attch/10/CHARLS/Family_Information.dta ## D:/0 zotero笔记/06-其它/3 公众号/1 blogpost-r/01-attch/10/CHARLS/Health_Status_and_Functioning.dta ## D:/0 zotero笔记/06-其它/3 公众号/1 blogpost-r/01-attch/10/CHARLS/Household_Income.dta ## D:/0 zotero笔记/06-其它/3 公众号/1 blogpost-r/01-attch/10/CHARLS/Individual_Income.dta ## D:/0 zotero笔记/06-其它/3 公众号/1 blogpost-r/01-attch/10/CHARLS/Sample_Infor.dta ## D:/0 zotero笔记/06-其它/3 公众号/1 blogpost-r/01-attch/10/CHARLS/Weights.dta ## D:/0 zotero笔记/06-其它/3 公众号/1 blogpost-r/01-attch/10/CHARLS/Work_Retirement.dta 13.1.3 第二步:批量导入 data_list &lt;- files |&gt; map(\\(filename) {import(file=filename)}) 可以看到已经导入成功 13.1.4 接下来美化一下 data_list_neat &lt;- set_names( data_list, files |&gt; map(\\(str) {str_remove(str, &quot;D:/0 zotero笔记/06-其它/3 公众号/1 blogpost-r/01-attch/10/CHARLS/&quot;)}) ) 可以看到列表每个元素名也规范了 13.2 批量导入excel下的多个sheet 现在我们有一个excel文件，其中有多个sheet，如何一次性导入到列表里呢 13.2.1 第一步:提取sheet名 sheet_names &lt;- readxl::excel_sheets( &quot;D:/0 zotero笔记/06-其它/3 公众号/1 blogpost-r/01-attch/10/CHARLS/data.xlsx&quot; ) sheet_names ## [1] &quot;gong&quot; &quot;bo&quot; &quot;hong&quot; &quot;wan&quot; &quot;he&quot; 13.2.2 第二步:批量导入 data_list &lt;- sheet_names |&gt; map(\\(var) {import( file=&#39;D:/0 zotero笔记/06-其它/3 公众号/1 blogpost-r/01-attch/10/CHARLS/data.xlsx&#39;, sheet = var) }) |&gt; set_names(sheet_names) ## New names: ## New names: ## New names: ## New names: ## New names: ## • `` -&gt; `...1` str(data_list) ## List of 5 ## $ gong:&#39;data.frame&#39;: 12 obs. of 9 variables: ## ..$ ...1: num [1:12] 1 2 3 4 5 6 7 8 9 10 ... ## ..$ 来源: chr [1:12] &quot;白云区&quot; &quot;白云区&quot; &quot;天河区&quot; &quot;天河区&quot; ... ## ..$ 重量: num [1:12] 0.501 0.502 0.498 0.497 0.499 0.496 0.5 0.503 0.5 0.501 ... ## ..$ 编号: chr [1:12] &quot;1.19④&quot; &quot;1.19⑨&quot; &quot;1.20⑦&quot; &quot;1.20⑧&quot; ... ## ..$ Cr : num [1:12] 0.3465 0.1507 0.0616 0.0745 0.7903 ... ## ..$ As : num [1:12] 1.87 4.63 9.89 3.43 3.02 ... ## ..$ Cd : num [1:12] 0.0262 0.2018 0.4037 0 0.0485 ... ## ..$ Pb : num [1:12] 0.0761 0.2169 0.0744 0.131 0.4851 ... ## ..$ Hg : num [1:12] 0.1011 0.0577 0.187 0.1879 0.0538 ... ## $ bo :&#39;data.frame&#39;: 12 obs. of 9 variables: ## ..$ ...1: num [1:12] 1 2 3 4 5 6 7 8 9 10 ... ## ..$ 来源: chr [1:12] &quot;白云区&quot; &quot;天河区&quot; &quot;天河区&quot; &quot;天河区&quot; ... ## ..$ 重量: num [1:12] 0.501 0.496 0.499 0.504 0.5 ... ## ..$ 编号: chr [1:12] &quot;1.19③&quot; &quot;1.20⑨&quot; &quot;1.20⑩&quot; &quot;1.21①&quot; ... ## ..$ Cr : num [1:12] 0.0198 0.0384 0.0375 0.7255 1.784 ... ## ..$ As : num [1:12] 6.08 2.76 3.1 2.45 3.23 ... ## ..$ Cd : num [1:12] 0.0639 0.0788 0.0217 0 0.0549 ... ## ..$ Pb : num [1:12] 0.2474 0.0799 0.0743 0.0906 0.0836 ... ## ..$ Hg : num [1:12] 0.0362 0.0671 0.0383 0.0527 0.0442 ... ## $ hong:&#39;data.frame&#39;: 12 obs. of 9 variables: ## ..$ ...1: num [1:12] 1 2 3 4 5 6 7 8 9 10 ... ## ..$ 来源: chr [1:12] &quot;白云区&quot; &quot;白云区&quot; &quot;天河区&quot; &quot;越秀区&quot; ... ## ..$ 重量: num [1:12] 0.496 0.498 0.499 0.5 0.501 ... ## ..$ 编号: chr [1:12] &quot;1.17②&quot; &quot;1.17④&quot; &quot;1.20⑥&quot; &quot;1.21⑩&quot; ... ## ..$ Cr : num [1:12] 1.283 0.636 0.233 1.073 0.979 ... ## ..$ As : num [1:12] 5.57 2.56 2.15 4.8 3.21 ... ## ..$ Cd : num [1:12] 0.1119 0.0241 0.0224 0 0 ... ## ..$ Pb : num [1:12] 0.157 0.0256 0.0745 0.1524 0.356 ... ## ..$ Hg : num [1:12] 0.37 0.184 1.375 1.49 0.469 ... ## $ wan :&#39;data.frame&#39;: 12 obs. of 9 variables: ## ..$ ...1: num [1:12] 1 2 3 4 5 6 7 8 9 10 ... ## ..$ 来源: chr [1:12] &quot;白云区&quot; &quot;白云区&quot; &quot;越秀区&quot; &quot;越秀区&quot; ... ## ..$ 重量: num [1:12] 0.497 0.498 0.493 0.499 0.498 ... ## ..$ 编号: chr [1:12] &quot;1.23⑦&quot; &quot;1.23⑧&quot; &quot;1.21⑤&quot; &quot;1.21⑥&quot; ... ## ..$ Cr : num [1:12] 4.011 4.461 0.899 0.816 0.326 ... ## ..$ As : num [1:12] 0.0396 0.0934 0 0 1.4307 ... ## ..$ Cd : num [1:12] 0 0 0 0 0 0 0 0 0 0 ... ## ..$ Pb : num [1:12] 0 0.5965 0.0808 0.0878 0 ... ## ..$ Hg : num [1:12] 0.0066 0.017 0.062 0.0196 0.0404 0.0559 0.0074 0.0437 0.0177 0.0122 ... ## $ he :&#39;data.frame&#39;: 12 obs. of 9 variables: ## ..$ ...1: num [1:12] 1 2 3 4 5 6 7 8 9 10 ... ## ..$ 来源: chr [1:12] &quot;白云区&quot; &quot;白云区&quot; &quot;天河区&quot; &quot;越秀区&quot; ... ## ..$ 重量: num [1:12] 0.497 0.497 0.5 0.501 0.501 0.5 0.502 0.502 0.497 0.501 ... ## ..$ 编号: chr [1:12] &quot;1.19②&quot; &quot;1.23⑨&quot; &quot;1.20⑤&quot; &quot;1.21④&quot; ... ## ..$ Cr : num [1:12] 0 3.746 0.221 1.027 3.893 ... ## ..$ As : num [1:12] 0.908 3.099 0.935 0.896 2.939 ... ## ..$ Cd : num [1:12] 0.0115 0.0884 0.0395 0 0.1448 ... ## ..$ Pb : num [1:12] 0.065 1.545 0.845 0.125 0.226 ... ## ..$ Hg : num [1:12] 0.3371 0.0898 0.1123 0.1392 0.1663 ... 13.3 尾语 本期主要使用了bruceR包和purrr包，基本可以满足日常数据导入的所有需求。 "]]
